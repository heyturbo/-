<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project TS</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            margin: 0;
            padding: 5px;
            color: #6f391c;
            align-items: center;
            font-size: 14px;
            background-color: black;
        }
        
        button, .display-area {
        }
        button {
            font-size: 12px;
        }
        .drawer-toggle {
            padding: 5px;
            text-align: center;
            background-image: url(https://pic.imgdb.cn/item/66bf32d9d9c307b7e9995d58.png);
            background-repeat: repeat;
            background-size: contain;
            color: #E3A73B;
            cursor: pointer;
            box-shadow: inset 0px 1px 2px 0px #E3A73B;
            border: 1px solid black;
        }
        
        .treasure-action button, .scalping-container button {
            border: 1px solid #6F391C;
            background: linear-gradient(to bottom, #E47F47, #CE6633, #963D1C);
            box-shadow: inset 0px 0px 2px 1px #87431F;
            font-size: 14px;
            border-radius: 5px;
            color: #F9DE9B;
            padding: 4px 6px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .treasure-action button:active {
            background-color: #064701;
        }
        .scalping-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background: rgb(0 0 0 / 80%);
            padding: 2px;
            border-radius: 2px;
            color: #87431f;
            font-size: 16px;
            height: 100%;
            background-image: url('https://pic.imgdb.cn/item/66ea60acf21886ccc04b6877.jpg');
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            z-index: 9999;
        }
        .scalping-head-button {
            background: transparent;
            color: #fff;
            box-shadow: 0px 0px 2px 1px #6f391c;
        }
        .scalping-container {
            width: 95%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background-image: url(https://pic.imgdb.cn/item/663885620ea9cb14033e4f6e.png);
            background-repeat: repeat;
            background-size: auto;
            border: 1px solid black;
            padding: 5px;
            justify-content: space-between;
        }
        .select-gadgets {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 95%;
            max-height: 80%;
            background-color: rgba(0, 0, 0, 0.8);
            color: #6f391c;
            border-radius: 2px;
            justify-content: center;
            flex-direction: column;
            align-items: center;
            background-image: url(https://pic.imgdb.cn/item/663885620ea9cb14033e4f6e.png);
            background-repeat: repeat;
            background-size: auto;
            border: 1px solid #6f391c;
        }
        
        .scalping-top-bar {
            font-weight: bold;
            width: 95%;
            overflow: hidden;
            display: flex;
            margin-bottom: 0px;
            flex-direction: row;
            justify-content: space-around;
            align-items: center;
            color: white;
            background: rgb(57, 87, 89);
            box-shadow: rgb(30, 46, 47) 0px 0px 5px 2px inset;
            height: 50px;
        }
        .scalping-asset-area {
            width: 95%;
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            border: 2px solid #87431f;
            align-items: center;
            flex-wrap: nowrap;
            height: 55px;
        }
        .scalping-middle-wrap {
            width: 100%;
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            gap: 10px;
        }
        .scalping-detail-list {
            width: 45%;
            display: flex;
            border-radius: 2px;
            flex-direction: column;
            align-items: center;
            border: 2px solid #6f391c;
            padding: 2px;
            min-height: 100px;
        }
        
        .scalping-warehouse {
            width: 45%;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid #6f391c;
            min-height: 100px;
            padding: 2px;
        }
        
        .scalping-bottom-area {
            display: flex;
            justify-content: space-between;
            width: 95%;
            padding: 5px;
            height: 40px;
            align-items: center;
        }

        .stock-panel {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="scalping-display" id="scalping-display" style="display:none;">
        <div id="scalping-head" class="drawer-toggle" style="font-weight:bold;padding:5px;width:95%;height:20px;display: flex;flex-direction: row;justify-content: space-between;align-items: center;"><button id="scalping-description" class="scalping-head-button" onclick="showInfoScalping()" style="margin-left:5px;">?</button><div>è‡ªç”±ç»å•†ï¼ˆç§¯åˆ†ï¼š<span id="scalping-score">0</span>ï¼‰</div><button id="close-scalping-button" onclick="saveGameState()" class="scalping-head-button" style="margin-right:5px">x</button></div>
        <div class="scalping-container" id="scalping-container">
            <div style="width: 100%;display: flex;flex-direction: column;align-items: center;gap: 10px;margin-top: 5px;" id="scalping-upper-area">
                <div class="scalping-top-bar" id="scalping-top-bar">
                    <div>ğŸ“… æ—¶é—´å·²è¿‡:</div>
                    <div style="display: flex;gap: 5px;flex-direction: column;font-size: 14px;align-items: center;">
                        <div>ç¬¬<span id="current-selling-week">0</span>å‘¨/<span id="max-selling-week">52</span>å‘¨</div>
                        <div id="gold-container" style="font-size: 12px;text-wrap: nowrap;text-overflow: ellipsis;">ğŸ’° é‡‘å­ï¼š<span id="gold-amount" style="cursor:pointer;">500ä¸¤</span></div>
                    </div>
                    <div style="display: flex;flex-direction: column;font-size: 14px; gap:5px;">
                        <div>ğŸ† å£°æœ›ï¼š<span id="player-reputation" style="cursor:pointer;">0</span></div>
                        <div style="cursor: pointer;">ğŸ„â€â™‚ï¸ ç²¾åŠ›ï¼š<span id="player-energy">100</span></div>
                    </div>
                </div>
                <div class="scalping-asset-area" id="scalping-asset-area">
                    <div style="display: flex;flex-direction: column;gap: 5px;font-weight: bold;">
                        <div>ğŸ’µ ç°é‡‘æµï¼š<span id="current-cash">0</span></div>
                        <div>ğŸ—ƒ æ€»èµ„äº§ï¼š<span id="net-asset">0</span></div>
                    </div>
                    <div id="scalping-gadgets-container" style="font-size: 12px;font-weight: bold;">
                        <div style="margin-top: 5px;margin-bottom: 5px;display: flex;gap: 2px;flex-direction: row;align-items: center;">
                            <button id="add-scalping-gadgets" onclick="selectSaclpingGadgets()">ç»å•†æ³•å®</button>
                            <div id="applied-scalping-gadgets" style="display: flex;gap: 2px;flex-direction: row;flex-wrap: nowrap;">
                                <!-- åŠ¨æ€ç”Ÿæˆæ³•å® -->
                            </div>
                        </div>
                        <div id="gadgets-selector" class="select-gadgets" style="display:none;padding: 0px 10px;">
                            <div id="gadgets-selector-head" class="drawer-toggle" style="font-weight:bold;width: 100%;height: 10px;display: flex;flex-direction: row;justify-content: space-between;align-items: center;font-size: 16px;padding: 10px;"><div>v1.1</div>ç»å•†æ³•å®<button onclick="closeGagdetsPanel()">x</button></div>
                            <div style="display:flex;width: 95%;justify-content: center;align-items: center;font-size:16px;padding: 5px;flex-direction: row;gap: 20px;">
                            <p>é€‰æ‹©ä½ æ‰€æ‹¥æœ‰çš„æ³•å®</p>
                            <button id="exchange-gadgets" onclick="exchangeGadgets()">å…‘æ¢æ³•å®</button>
                            </div>
                            <div id="selected-gadgets" style="max-height: 420px;padding: 10px;overflow-y: scroll;min-height: 300px;border: 2px double #87431f;margin-bottom: 20px;width:95%">
                                <!-- éå†æ³•å®å¹¶åœ¨æ­¤å¤„æ˜¾ç¤º -->
                            </div>
                        </div>
                        <div id="gadget-store-panel" class="select-gadgets" style="display:none;">
                            <div id="gadgets-store-head" class="drawer-toggle" style="font-weight:bold;padding:0px;width:100%;height:30px;display: flex;flex-direction: row;justify-content: space-between;align-items: center;font-size:16px;"><div>v1.1</div>å…‘æ¢æ³•å®<button id="close-gagdet-store">x</button></div>
                            <div style="display:flex;font-size: 16px;flex-direction: row;justify-content: center;align-items: center;width:100%;">
                            <p>ä½ å¯ä»¥ä½¿ç”¨ç»å•†ç§¯åˆ†ç‚¹å‡»å›¾æ ‡å…‘æ¢æ³•å®</p>
                            </div>
                            <div id="gadget-items" style="max-height: 480px;padding: 10px;overflow-y: scroll;">
                                <!-- æ­¤å¤„å‡½æ•°ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                    <div><button id="add-investment" onclick="increaseInverstment()">å¢åŠ æŠ•èµ„</button></div>
                </div>
                <div class="scalping-middle-wrap" id="scalping-middle-wrap">
                    <div class="scalping-detail-list" id="market-info">
                        <strong style="height: 30px;display: flex;align-items: center;">å¸‚åœº<button id="select-item-to-display" onclick="generateItemToDisplay()" style="margin-left:5px;font-weight: bolder;padding: 0px 2px;">ï¼‹</button></strong>
                        <div id="scalping-item-info-container" style="width: 100%;gap: 10px;display: flex;flex-direction: column;">
                            <div style="display: flex;width: 100%;flex-direction: row;justify-content: space-around;">
                                <div>è´§ç‰©</div>
                                <div>ä»·æ ¼</div>
                            </div>
                        <div id="scalping-item-info" style="padding: 5px;border-top: 2px solid #6f391c;background-image: url(https://pic.imgdb.cn/item/66da9042d9c307b7e9e14b2b.png);color: white;max-height: 300px;overflow-y: scroll;">
                            <!-- åŠ¨æ€ç”Ÿæˆå•†å“ -->
                        </div>
                        </div>
                    </div>
                    <div class="scalping-warehouse" id="warehouse-info">
                        <strong style="height: 30px;display: flex;align-items: center;">ä»“åº“(<span id="used-warehouse-capacity">0</span>/<span id="max-warehouse-capacity">100</span>)<button id="enlarge-warehouse-button" style="margin-left:5px;font-weight: bolder;padding: 0px 2px;">ï¼‹</button></strong>
                        <div id="warehouse-item-info-container" style="width: 100%;gap: 10px;display: flex;flex-direction: column;">
                            <div style="display: flex;width: 100%;flex-direction: row;justify-content: space-around;">
                                <div>è´§ç‰©</div>
                                <div>å‡ä»·</div>
                                <div>æ•°é‡</div>
                            </div>
                            <div id="warehouse-item-info" style="padding: 5px;border-top: 2px solid #6f391c;background-image: url(https://pic.imgdb.cn/item/66da9042d9c307b7e9e14b2b.png);color: white;max-height: 300px;overflow-y: scroll;">
                                <!-- åŠ¨æ€ç”Ÿæˆä»“åº“å•†å“ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="width: 100%;display: flex;flex-direction: column;align-items: center;align-content: space-between;flex-wrap: wrap;">
                <div class="scalping-bottom-area" id="stock-area" style="border-radius: 5px;color: white;width: 95%;padding: 5px;">
                    <div style="display: flex;align-items: center;flex-direction: row;"><button id="open-stock-button" onclick="openStockPanel()">æŠ•èµ„è‚¡ç¥¨</button></div>
                    <div id="stock-info-display" style="display:flex;font-size: 14px;text-wrap: nowrap;overflow: hidden;background: rgb(57, 87, 89);box-shadow: rgb(30, 46, 47) 0px 0px 5px 2px inset;color: white;width: 75%;align-items: center;flex-direction: row;padding: 5px;justify-content: center;">å½“å‰æ²¡æœ‰æŠ•èµ„ä»»ä½•è‚¡ç¥¨</div>
                    <div class= "stock-panel" id="stock-panel" style="display:none">
                        <!-- åŠ¨æ€ç”Ÿæˆè‚¡ç¥¨ä¿¡æ¯ -->
                    </div>
                </div>
                <div class="scalping-bottom-area" id="scalping-bottom-area">
                    <div><button id="quit-scalping" onclick="quitScalping()">æå‰é€€å¸‚</button></div>
                    <div><button id="relax-byweek" style="display: none">ä¼‘æ¯ä¸¤å‘¨</button></div>
                    <div><button id="enter-next-week" onclick="refreshSaleWeek()">åˆ·æ–°ä¸€å‘¨</button></div>
                </div>
            </div>
        </div>
    </div>
    <script>
    let scalpingState = {
        currentSellingWeek: 0,
        maxSellingWeek: 52,
        playerReputation: 0,
        playerEnergy: 100,
        currentCash: 0, // ç¤ºä¾‹åˆå§‹ç°é‡‘
        netAsset: 0, 
        usedWarehouseCapacity: 0,
        maxWarehouseCapacity: 100, // åˆå§‹ä»“åº“å®¹é‡
        warehouseUpdateCount: 0,
        investmentCount: 0,
        holdItems: {}, // å­˜æ”¾ç©å®¶è´­ä¹°çš„å•†å“
        gadgets: [], //ç©å®¶ä½¿ç”¨çš„å¢ç›Šé“å…·
        achievements: []
    };
        
    let scalpingScore = 10000; //ç”¨äºå…‘æ¢æ³•å®
    let highestAsset = 0;
    let jinnangItems = [
        { name: 'rareEventBooster', displayName: 'å…«æ–¹æ¥è´¢', url: 'https://pic.imgdb.cn/item/66e683eed9c307b7e9551be4.png', price: 2000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰åº”ç”¨æ­¤æ³•å®æ—¶ï¼Œä½ åœ¨ç»å•†æ—¶é‡åˆ°å¸‚åœºç‰¹æ®Šäº‹ä»¶çš„æ¦‚ç‡æå‡50%' },
        { name: 'fitnessPowder', displayName: 'å¼ºèº«æ•£', url: 'https://pic.imgdb.cn/item/66e683eed9c307b7e9551bdf.png', price: 2000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰åº”ç”¨æ­¤æ³•å®æ—¶ï¼Œæ¯å‘¨ç²¾åŠ›ä¸‹é™çš„å¹…åº¦å‡å°‘30%' },
        { name: 'heroToken', displayName: 'è‹±é›„ä»¤', url: 'https://pic.imgdb.cn/item/66e6841ad9c307b7e9554384.png', price: 2000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰ä½œä¸ºå¯¹è‹±é›„çš„å°Šæ•¬ï¼Œåº”ç”¨æ­¤æ³•å®æ—¶ï¼Œæ¯å‘¨åº—ç§Ÿä¸‹é™30%' },
        { name: 'extensionCharter', displayName: 'ç»­ç§Ÿå¥‘', url: 'https://pic.imgdb.cn/item/66e68b4ed9c307b7e962b841.png', price: 2000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰åº”ç”¨æ­¤æ³•å®æ—¶ï¼Œç»å•†æ—¶é—´å¯ç‰¹è®¸å»¶é•¿ä¸€ä¸ªæœˆï¼ˆ4å‘¨ï¼‰' },
        { name: 'treasureWood', displayName: 'çå®æ¡ˆ', url: 'https://pic.imgdb.cn/item/66e68b4dd9c307b7e962b7ca.png', price: 2000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰æ­¤æ³•å®åº”ç”¨åå¯é™ä½20%æœªå˜ç°çš„èµ„äº§ç¼©æ°´å¹…åº¦' },
        { name: 'investmentCharter', displayName: 'ç‰¹è®¸æ‹›å•†ä»¤', url: 'https://pic.imgdb.cn/item/66e68c8ed9c307b7e963c42d.png', price: 2000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰åº”ç”¨æ­¤æ³•å®åï¼Œå¯é¢å¤–å¢åŠ ä¸€æ¬¡æŠ•èµ„æ¬¡æ•°' },
        { name: 'merchantPointsCard', displayName: 'ç»å•†ç§¯åˆ†å¡', url: 'https://pic.imgdb.cn/item/66e6a031d9c307b7e97c84c7.png', price: 1000, quantity: 5, description: 'æ‰“å¼€åå¯ä»¥è·å¾—2000ç‚¹ç»å•†ç§¯åˆ†ã€‚ç»å•†ç§¯åˆ†ç”¨äºåœ¨å•†åº—-å€’ä¹°å€’å–è´­ä¹°ç»å•†æ³•å®ï¼Œå¢åŠ ä½ çš„èµ„äº§è¿ä½œèƒ½åŠ›' },
        { name: 'wealthOfNations', displayName: 'å›½å¯Œè®º', url: 'https://pic.imgdb.cn/item/66e7aabfd9c307b7e9ce4e8c.png', price: 1000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰äºšå½“æ–¯å¯†ä½œä¸ºç»æµå­¦å¤§å¸ˆï¼Œè®¤ä¸ºç®¡ç†è€…åº”å½“ä¸€å®šç¨‹åº¦å¹²æ¶‰å¸‚åœºï¼Œæœ¬å¹´åº¦å¸‚åœºæ¯å‘¨å•†å“æ•°é‡ä¸‹é™å°†æå‡1' },
        { name: 'revokeSand', displayName: 'å”¤ç¥ç ‚', url: 'https://pic.imgdb.cn/item/66e7aabfd9c307b7e9ce4e59.png', price: 1000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰åœ¨ç²¾åŠ›ä¸æ”¯æ—¶ï¼Œä»ç„¶èƒ½å¤Ÿæ”¯æŒä½ è¿›è¡Œä¸€æ¬¡ä¹°å–è¡Œä¸ºï¼Œç”Ÿæ•ˆåè‡ªåŠ¨å¤±æ•ˆ' },
        { name: 'qianKunBag', displayName: 'ä¹¾å¤è¢‹', url: 'https://pic.imgdb.cn/item/66e82554d9c307b7e96cab02.png', price: 1000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰å³ä½¿å¸‚é¢å¹¶æ²¡æœ‰ä»“åº“å†…çš„è´§ç‰©ï¼Œä»èƒ½å¤Ÿä»¥è¿›è´§ä»·å‡ºå”®ä¸€æ¬¡ï¼Œç”Ÿæ•ˆåè‡ªåŠ¨å¤±æ•ˆ' },
        { name: 'doubleLuck', displayName: 'åŒå–œä¸´é—¨', url: 'https://pic.imgdb.cn/item/66e8256dd9c307b7e96cc570.png', price: 1000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰ç»å•†ç»“æŸæ—¶ï¼Œç§¯åˆ†ç»“ç®—ç¿»å€' },
        { name: 'zibenyunzuo', displayName: 'èµ„æœ¬è¿ä½œ', url: 'https://pic.imgdb.cn/item/66e99553f21886ccc0502e94.png', price: 1000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰é€šè¿‡é«˜æ•ˆçš„èµ„æœ¬è¿ä½œï¼ŒæŠ•èµ„è‚¡ç¥¨åå‡å°‘ä¸€å‘¨æ”¶ç›Šç­‰å¾…æ—¶é—´' },
        { name: 'kaimanzhizhao', displayName: 'å¼€æ›¼å²›æ‰§ç…§', url: 'https://pic.imgdb.cn/item/66e994f2f21886ccc04fd099.png', price: 1000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰å°†ä¼ä¸šæ³¨å†Œåœ¨é¿ç¨å¤©å ‚ï¼Œäº¤æ˜“è‚¡ç¥¨æ—¶ç¨è´¹å‡å°‘50%' },
        { name: 'jiazuxintuo', displayName: 'å®¶æ—ä¿¡æ‰˜', url: 'https://pic.imgdb.cn/item/66ed48f0f21886ccc007aa0b.png', price: 1000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰æ¥è‡ªæƒè´µå®¶æ—çš„å§”æ‰˜åŸºé‡‘ï¼Œæ¯å‘¨å°†éšæœºè·å¾—5000~10000å…ƒç°é‡‘' },
        { name: 'caopanjubo', displayName: 'æ“ç›˜å·¨æ“˜', url: 'https://pic.imgdb.cn/item/66ed48f0f21886ccc007a9ff.png', price: 1000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰åº”ç”¨æ­¤æ³•å®æ—¶ï¼Œå°†å»¶é•¿50%è‚¡ç¥¨å‘¨æœŸçš„æŒç»­æ—¶é—´ï¼ˆæ— è®ºç‰›å¸‚/ç†Šå¸‚éƒ½ä¼šå»¶é•¿ï¼‰' },
        { name: 'timeMachine', displayName: 'ç™¾è¾¾ç¿¡ä¸½', url: 'https://pic.imgdb.cn/item/66ed48f0f21886ccc007a9e5.png', price: 1000, quantity: 0, description: 'ã€ç»å•†æ³•å®ã€‘ï¼ˆä»…åœ¨å•†åº—-å€’ä¹°å€’å–ä¸­ä½¿ç”¨ï¼‰ä»¤äººç€è¿·çš„ç™¾è¾¾ç¿¡ä¸½605æ€€è¡¨ï¼Œåº”ç”¨æ­¤æ³•å®æ—¶ï¼Œå°†æœ‰15%æ¦‚ç‡åœ¨æ¯å‘¨åˆ·æ–°æ—¶ä¸æ›´æ–°æ—¶é—´' },
    ];    
    let scalpingItems = [
        {name: 'é™ˆé…¿å¥³å„¿çº¢', url: 'https://pic.imgdb.cn/item/66e2e21ed9c307b7e9177f3f.png', itemActivate: false, downRate: 2, basePrice: 1500, bonusPrice: 8000, fluctuation: 0.2, goodEvent: 'æœ¬å‘¨é€‚é€¢ä¸‰ç•Œæœ€è½°åŠ¨çš„ç¥ä»™å“é…’å¤§ä¼šï¼Œå¥³å„¿çº¢è¢«ç‚’ä½œè‡³æ–°é«˜ï¼', badEvent: 'å…¨é¢ç¦é…’å‘¨ï¼Œç¾é…’è™½å¥½ï¼Œä»ä¸èƒ½è´ªæ¯å“¦', description: 'é™ˆé…¿å¥³å„¿çº¢ï¼Œé…’é¥•çš„ç››å®´'},
        {name: 'å½’å…ƒçµç‰', url: 'https://pic.imgdb.cn/item/66e2ded9d9c307b7e9132d0f.png', itemActivate: false, downRate: 1.5, basePrice: 20000, bonusPrice: 500000, fluctuation: 0.3, goodEvent: 'ä»™äººæ±Ÿçµå­è¿‘æ—¥å‡­é å½’å…ƒçµç‰çš„çµå‹æˆåŠŸè·ƒå‡ä¿®ä»™è€…ï¼Œä¸‰ç•Œä¸Šä¸‹ç«‹å³æ€èµ·ä¿®ä»™çƒ­ï¼Œå½’å…ƒçµç‰è¢«ç‚’è‡³å†å²æ–°é«˜', badEvent: 'å§œå¤ªåä¸‹ä»¤ç½¢é»œç™¾å®¶ï¼Œä¿®ä»™è€…å› é¼“åŠ±æ— ä¸ºè€Œè¢«åˆ—å…¥é‡ç‚¹æ‰“å‡»å¯¹è±¡ï¼Œå½’å…ƒçµç‰ä»·æ ¼é‡å†·', description: 'å½¢è‹¥é’»çŸ³çš„çµç‰ï¼Œä¿®ç‚¼åŠŸæ³•çš„ç»ä½³åª’ä»‹'},
        {name: 'ç¥å™¨ç¢ç‰‡', url: 'https://pic.imgdb.cn/item/66e2dfdfd9c307b7e9149cda.png', itemActivate: false, downRate: 1, basePrice: 400, bonusPrice: 1000, fluctuation: 0.1, goodEvent: 'æœ€è¿‘æœå»·åŠ¨è¡ï¼Œä¼¼ä¹æœ‰æ”¿å˜å‘ç”Ÿï¼Œå„è·¯è±ªæ°çº·çº·å¸¦ä¸Šè¶æ‰‹çš„æ­¦å™¨å»ä¸€æ¢ç©¶ç«Ÿï¼Œé”»é€ æ‰€ç”¨çš„ç¥å™¨ç¢ç‰‡ä»·æ ¼æ”€å‡', badEvent: 'ä¸¾ä¸–å¤ªå¹³ï¼Œæ­¦å™¨è£…å¤‡æ— äººé—®æ´¥ï¼ŒåŸææ–™ç¥å™¨ç¢ç‰‡æš´è·Œ', description: 'ä¼ è¨€å–è‡ªä¼ç¾²ç´çš„ä¸€ä¸çµåŠ›å‡ç»“è€Œæˆçš„ç¢ç‰‡ï¼Œæ˜¯é”»é€ ç¥å…µçš„å¿…å¤‡ææ–™'},
        {name: 'é‡‘é¾™è›‹', url: 'https://pic.imgdb.cn/item/66e2e105d9c307b7e91616e1.png', itemActivate: false, downRate: 1, basePrice: 200, bonusPrice: 4000, fluctuation: 0.05, goodEvent: 'â€œæ˜¯çœŸçš„å°é‡‘é¾™ï¼â€å¤´æ¡ä¸€ç»å‘å¸ƒï¼Œé‡‘é¾™è›‹çš„â€œå‰²éŸ­èœâ€è°£è¨€ä¸æ”»è‡ªç ´ï¼Œé”€é‡é•¿è™¹', badEvent: 'â€œä»€ä¹ˆå•Šï¼ŒåŸæ¥æ˜¯å°é¸­å­ï¼â€1818é»„é‡‘çœ¼æ­éœ²é‡‘é¾™è›‹éª—å±€ï¼Œç«Ÿæ˜¯å°é¸­å­ä¼ªè£…å°é‡‘é¾™è—åŒ¿å…¶ä¸­ï¼éª—å±€ä¸€ç»æ‹†ç©¿ï¼Œé‡‘é¾™è›‹ä»·æ ¼ä¹Ÿéšåå£°è·Œè½ç¥å›', description: 'ç¥å¥‡çš„ä¸€é¢—è›‹ï¼Œä¼¼ä¹æœ‰å¹¼å°çš„ç”Ÿå‘½æ­£åœ¨å­•è‚²ï¼Œä¸å°‘ä¾ å£«æ­£åœ¨æ”¶è´­ä»¥çª¥ç©¶ç«Ÿ'},
        {name: 'ç¿¡ç¿ ç‰ç', url: 'https://pic.imgdb.cn/item/66e2e180d9c307b7e916b19f.png', itemActivate: false, downRate: 1.5, basePrice: 2000, bonusPrice: 4000, fluctuation: 0.15, goodEvent: 'ç‰çå°±æ˜¯æœäº‘å›½çš„é»„é‡‘ï¼è¿™å¥sloganä¸€ç»æ‰“å“ï¼Œå¼•æ¥å„ç•Œäººå£«å¯¹å¤ç©çš„å¼ºçƒˆå…´è¶£', badEvent: 'é»„é‡‘æ°¸è¿œæ˜¯é»„é‡‘ï¼Œå°¤å…¶åœ¨çœŸçš„é»„é‡‘é¢å‰ï¼Œä½ ä¼šé€‰è°ï¼Ÿè¿™å¥è¾©è®ºå¾ˆå¿«è­¦é†’äº†æŠ¢è´­ç‰ççš„æ°‘ä¼—ï¼Œçº·çº·æŠ›å”®ä¹‹', description: 'ä¸Šå¥½çš„ç‰çï¼Œå¤ç©ç•Œä¸ä¹ç‹‚çƒ­çš„æ‹¥è¶¸'},
        {name: 'ç«ç‘°èŠ±æŸ', url: 'https://pic.imgdb.cn/item/66e3240bd9c307b7e994944b.png', itemActivate: false, downRate: 1, basePrice: 600, bonusPrice: 3000, fluctuation: 0.35, goodEvent: 'æœ¬å‘¨æ˜¯ä¸‰ç•Œæƒ…äººå‘¨ï¼ŒèŠ±æŸä¸€ç»ä¸Šå¸‚ä¾¿è¢«æŠ¢è´­ä¸€ç©º', badEvent: 'ç»æµä¸‹è¡Œï¼Œæ°‘ä¼—éƒ½ä¸è¿‡æƒ…äººèŠ‚äº†ï¼ŒèŠ±æŸä»·æ ¼ä¸€è½åƒä¸ˆ', description: 'å¤©é•¿åœ°ä¹…ï¼Œçˆ±æ— æ­¢ä¼‘'},
        {name: 'æ‹‡æŒ‡ç”Ÿç…', url: 'https://pic.imgdb.cn/item/66e3c0f6d9c307b7e954f14e.png', itemActivate: false, downRate: 1, basePrice: 200, bonusPrice: 500, fluctuation: 0.5, goodEvent: 'æœäº‘å›½ç››äº§å„è·¯ç½‘çº¢ï¼Œæ‹‡æŒ‡ç”Ÿç…æ˜¯å¸¦è´§çš„ç‹ç‰Œäº§å“ï¼Œä¸€ç»æ¨å‡ºç«çˆ†å…¨ç½‘ï¼', badEvent: 'ç½‘çº¢æ°¸è¿œæ˜¯ç½‘çº¢ï¼Œå£å‘³ä¸å¥½è¯´ä»€ä¹ˆéƒ½æ˜¯ç™½æ­ï¼Œæ‹‡æŒ‡ç”Ÿç…ä¸æ˜¯è·Œä»·ï¼Œåªæ˜¯å›åˆ°äº†å®ƒåº”å¾—çš„ä»·ä½', description: 'çŠ¶å¦‚æ‹‡æŒ‡çš„å°ä¸ªå¤´ç”Ÿç…åŒ…ï¼Œæ›¾åœ¨å„å¤§åŸå¸‚å°åƒè¡—é£é¡ä¸€æ—¶'},
        {name: 'çè´µçš®è‰', url: 'https://pic.imgdb.cn/item/66e3c0f6d9c307b7e954f131.png', itemActivate: false, downRate: 2, basePrice: 20000, bonusPrice: 40000, fluctuation: 0.15, goodEvent: 'æ—¶è£…å‘¨æ¥è¢­ï¼Œé«˜å®šï¼Ÿè®¾è®¡å¸ˆå“ç‰Œï¼Ÿæ‹¼æ¥å…ƒç´ ï¼Ÿæ²¡æœ‰åŸææ–™ç»Ÿç»Ÿéƒ½ä¸è¡Œï¼æœ¬å‘¨è°æ‹¥æœ‰çš®è‰è°å°±æ˜¯æœ€å¤§èµ¢å®¶ï¼', badEvent: 'æ²¡æœ‰ä¹°å–ï¼Œå°±æ²¡æœ‰æ€å®³â€”â€”â€”â€”å“ªæ€•ä½ æ€çš„æ˜¯å·¨å¤§çš„æ£•ç†Šã€‚çš®è‰å¸‚åœºè¢«è‚ƒæ¸…ï¼Œå•†äººä»¬çº·çº·ç”©è´§', description: 'ä¸çŸ¥æ˜¯å–è‡ªå“ªç§å‡¶ç‹ é‡å…½ä¹‹èº«ï¼Œæ¯›å‘ç»µå¯†æŸ”è½¯ï¼Œä¿æ¸©æ•ˆæœæå¥½'},
        {name: 'å—éæ°´æ™¶', url: 'https://pic.imgdb.cn/item/66e7aabfd9c307b7e9ce4e9e.png', itemActivate: false, downRate: 2.5, basePrice: 20000, bonusPrice: 300000, fluctuation: 0.05, goodEvent: 'è¡—å¤´ä¼ è¨€æ¥è‡ªéæ´²å¤§é™†çš„æ°´æ™¶åŸçŸ³å¼€çŸ³åä¼šéœ²å‡ºé‡‘çŸ¿ï¼Œä¸€æ—¶é—´å—éæ°´æ™¶è¢«ç‹‚çƒ­çš„æ·˜é‡‘å®¢ä¸€ä¸¾æ”¶ç½„', badEvent: 'ä½œä¸ºå·¥è‰ºå“çš„åŸææ–™ï¼Œå—éæ°´æ™¶æ˜¯å¥½ä¸œè¥¿ï¼›ä½œä¸ºæ·˜é‡‘å®¢çš„ç¾æ¢¦ï¼Œå®ƒåªèƒ½æ²¦ä¸ºç ´ç¢ï¼Œå—éæ°´æ™¶å¤§è·³æ°´', description: 'æœäº‘èˆ¹é˜ŸæŠµè¾¾å¥½æœ›è§’ï¼Œåœ¨å½“åœ°å¼€é‡‡äº†ä¸å°‘è¿™ç§å½¢åˆ¶åšç¡¬é€äº®çš„çŸ¿çŸ³ï¼Œè®ºå¯†åº¦åˆæ¯”ä¼ ç»Ÿæ°´æ™¶æ›´å¤§ï¼Œä¼¼ä¹æœ‰ç§˜å¯†åœ¨å…¶ä¸­'},
        {name: 'æœˆé¥¼', url: 'https://pic.imgdb.cn/item/66e7aabfd9c307b7e9ce4eae.png', itemActivate: false, downRate: 1, basePrice: 100, bonusPrice: 2000, fluctuation: 0.15, goodEvent: 'ä¸­ç§‹ä½³èŠ‚ï¼Œæœˆé¥¼ä¹Ÿæˆäº†èµ°äº²è®¿å‹çš„é€ç¤¼ä½³å“ï¼Œæ‰€è°“è´µçš„å°±æ˜¯å¥½çš„ï¼Œæœˆé¥¼ä¹Ÿåœ¨èŠ‚æ—¥æ°›å›´é‡Œèº«ä»·å€æ¶¨', badEvent: 'ç°ä»£äººå´‡å°šä½ç¢³æ°´ã€ä½ç³–çš„é¥®é£Ÿä½œé£ï¼Œæœˆé¥¼å¤§é‡ä¸´æœŸï¼ŒæŠ˜ä»·å¤„ç†', description: 'å†œå†å…«æœˆåäº”ï¼Œæ˜¯ä¸‡å®¶ç¯ç«å…±å›¢åœ†çš„æ—¥å­'},
        {name: 'æµªå››æµ·', url: 'https://pic.imgdb.cn/item/66ebc319f21886ccc0a21f39.png', itemActivate: false, downRate: 2, basePrice: 3000, bonusPrice: 6000, fluctuation: 0.4, goodEvent: 'å°é•¿å‡ï¼Œè¸ä¸Šæµªå››æµ·äº‘æ¸¸å››æ–¹æˆä¸ºè¶Šæ¥è¶Šå¤šä¿®ä»™è€…çš„ç”Ÿæ´»æ–¹å¼ï¼Œæµªå››æµ·ä»·æ ¼èµ°ä¿', badEvent: 'ç”±äºç¾½æ—å¼€å‘äº†â€œå…±äº«ç¾½ç¿¼â€ï¼Œæµªå››æµ·å› æˆæœ¬è¿‡é«˜é—®é¢˜å¤±å»äººä»¬é’ç', description: 'ä¸ä»…æ‹¥æœ‰é£å‰‘çš„éœ¸æ°”é€ å‹ï¼Œæ›´æœ‰ä¸€ä¸ªå“äº®çš„åå­—ï¼šâ€œæµªå››æµ·ï¼'},
        {name: 'çµé›¨', url: 'https://pic.imgdb.cn/item/66ebc319f21886ccc0a21f10.png', itemActivate: false, downRate: 4, basePrice: 15000, bonusPrice: 30000, fluctuation: 0.4, goodEvent: 'ä¸€å¹´ä¸€åº¦çš„èµ›çº§å¤§çŒ«å‡ºåœˆä¸‰ç•Œâ€”â€”æ›´æŸ”é¡ºçš„æ¯›çš®å’Œæ›´ç¾çš„å“ç›¸ï¼å¸¦åŠ¨çµé›¨å…¨çº¿ä»·æ ¼ä¸Šå‡', badEvent: 'å¤§çŒ«å›ºç„¶å¯çˆ±ï¼Œåƒç¯‡ä¸€å¾‹ç»ˆè®©äººå®¡ç¾ç–²åŠ³ï¼Œä»·æ ¼å›å½’ä½ä½', description: 'å¤–å½¢å‡ºä¼—ï¼Œæ€§æ ¼æ¸©é¡ºçš„çµçŒ«ï¼Œæ“…é•¿ä¸ºä¿®ä»™è€…æä¾›å„ç§å¢ç›Šå’Œæƒ…ç»ªä»·å€¼'}
    ];
    
    let stockList = [
        {unit: 1, name: 'å½±æœˆåŠå·¥ä½œå®¤', threshold: 100000, dealWeek: 2, quantity: 0, price: 0.5, basePrice: 0.5, flow: 0.05, state: null, fluctuation: 0.03, quality: 'bad', url:'https://pic.imgdb.cn/item/66e9380df21886ccc0ca0085.png', des:'é å±±åƒå±±ï¼Œé æ°´åƒæ°´ã€‚åŒ—å½±æœˆæ‘æ°‘åæ‹¥ä¸¤å¤§é‡ç”Ÿæ£®æ—ï¼Œå¤§åŠ›å‘å±•çººç»‡ä¸šï¼Œç”·è€•å¥³ç»‡è‡ªç»™è‡ªè¶³' },
        {unit: 2, name: 'é»‘æ°´æ°´äº§å•†è¡Œ', threshold: 500000, dealWeek: 3, quantity: 0, price: 10, basePrice: 10, flow: 0.15, state: null, fluctuation: 0.03, quality: 'medium', url:'https://pic.imgdb.cn/item/66e9380cf21886ccc0ca0060.png', des:'çµä»™å²›å²›æ°‘åœ¨ä»™äººé£å‡æˆåå‰ä¸€ç›´ä»¥æ•é±¼ä¸ºä¸šï¼Œé»‘è‰²æ°´åŸŸé è¿‘å²›å†…ï¼Œæ­¤å¤„ç››äº§å¤§é—¸èŸ¹ï¼Œä½†å¶å°”æœ‰æ¯’è›‡ä¼¤äººäº‹ä»¶' },
        {unit: 3, name: 'ç©ºå²›æ—…è¡Œä¼šç¤¾', threshold: 1500000, dealWeek: 3, quantity: 0, price: 60, basePrice: 60, flow: 3, state: null, fluctuation: 0.03, quality: 'medium', url:'https://pic.imgdb.cn/item/66ea482af21886ccc02b21b3.png', des:'å—å¤©ç©ºçœ·é¡¾çš„ä¸€æ—â€”â€”ç¾½æ—èšå±…åœ°ï¼Œæ­¤å¤„ç”±æ‚¬ç©ºæµ®å²›ç»„æˆï¼Œæ˜¯å¤©ä¹¦å¤§é™†æ—…æ¸¸ä¸šæœ€ç¹è£çš„åœ°æ–¹' },
        {unit: 4, name: 'é‡‘æ¸¯ç å¤´é›†å›¢', threshold: 3000000, dealWeek: 3, quantity: 0, price: 150, basePrice: 150, flow: 7, state: null, fluctuation: 0.03, quality: 'medium', url:'https://pic.imgdb.cn/item/66e9380cf21886ccc0ca0045.png', des:'ä½œä¸ºæœäº‘å›½æœ€ç¹åçš„æ¸¯å£ï¼Œæ˜¯èµ„æœ¬ä¸»ä¹‰èŒèŠ½çš„åœ°æ–¹ã€‚å¹¿è´Ÿç››åçš„æœäº‘å•†ä¼šåœ¨æ­¤åœ°é©»æ‰ï¼Œä»¤å¤–è´¸æˆä¸ºæœäº‘å›½çš„æ”¯æŸ±äº§ä¸šä¹‹ä¸€' },
        {unit: 5, name: 'çš‡åŸåœ°äº§æ§è‚¡', threshold: 5000000, dealWeek: 5, quantity: 0, price: 300, basePrice: 300, flow: 15, state: null, fluctuation: 0.03, quality: 'good', url:'https://pic.imgdb.cn/item/66e9380cf21886ccc0ca001a.png', des:'æ— è®ºè¿‡å»è¿˜æ˜¯æœªæ¥ï¼Œæˆ¿åœ°äº§éƒ½æ˜¯æ°¸æ’çš„ç‹ç‰Œ' },
        {unit: 6, name: 'æ˜Ÿä¹‹æµ·æ‰˜æ‹‰æ–¯', threshold: 10000000, dealWeek: 5, quantity: 0, price: 1000, basePrice: 1000, flow: 30, state: null, fluctuation: 0.03, quality: 'good', url:'https://pic.imgdb.cn/item/66e9380cf21886ccc0c9ffba.png', des:'å¤©ä¹¦å¤§èˆªæµ·æ—¶ä»£æ¥ä¸´ï¼ŒæŠ•èµ„ä½ çš„æµ·åº•æ˜é‡‘ä¼ä¸šï¼Œå¾æˆ˜æ˜Ÿè¾°å’Œå¤§æµ·' },
    ];
    
    let isStock = false;
    
    function openStockPanel() {
        const middleWrap = document.getElementById('scalping-middle-wrap');
        const stockButton = document.getElementById('open-stock-button');
    
        if (scalpingState.currentSellingWeek === 0 && stockButton.innerText === 'æŠ•èµ„è‚¡ç¥¨') {
            showMerchant('è‡³å°‘åœ¨å¸‚åœºç§¯ç´¯ä¸€å‘¨çš„ç»å•†ç»éªŒæ‰èƒ½è¿›å…¥è‚¡å¸‚ï¼');
            return;
        }
        
        if (!isStock) {
            hideMiddleWrapElement();
            setTimeout(() => updateStockPanelDisplay(), 0); // ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œç¡®ä¿å‡½æ•°åœ¨setTimeoutåæ‰§è¡Œ
            isStock = true;
            stockButton.innerText = 'è¿”å›å¸‚åœº';
        } else {
            showMiddleWrapElement();
            isStock = false;
            stockButton.innerText = 'æŠ•èµ„è‚¡ç¥¨';
        }
    }
    
    function hideMiddleWrapElement() {
        const middleWrapElement = document.getElementById('scalping-middle-wrap');
        middleWrapElement.style.display = 'none';  // éšè—åŸæœ‰å†…å®¹
        
    }
    
    function showMiddleWrapElement() {
        const middleWrapElement = document.getElementById('scalping-middle-wrap');
        const upperArea = document.getElementById('scalping-upper-area');
        const stockPanel = document.getElementById('general-stock-panel');
        upperArea.removeChild(stockPanel);
        middleWrapElement.style.display = 'flex';  // æ¢å¤æ˜¾ç¤ºåŸæœ‰å†…å®¹
        
    }
            
    function resetStockState() {
        stockList = [
            {unit: 1, name: 'å½±æœˆåŠå·¥ä½œå®¤', threshold: 100000, dealWeek: 2, quantity: 0, price: 0.5, basePrice: 0.5, flow: 0.05, state: null, fluctuation: 0.03, quality: 'bad', url:'https://pic.imgdb.cn/item/66e9380df21886ccc0ca0085.png', des:'é å±±åƒå±±ï¼Œé æ°´åƒæ°´ã€‚åŒ—å½±æœˆæ‘æ°‘åæ‹¥ä¸¤å¤§é‡ç”Ÿæ£®æ—ï¼Œå¤§åŠ›å‘å±•çººç»‡ä¸šï¼Œç”·è€•å¥³ç»‡è‡ªç»™è‡ªè¶³' },
            {unit: 2, name: 'é»‘æ°´æ°´äº§å•†è¡Œ', threshold: 500000, dealWeek: 3, quantity: 0, price: 10, basePrice: 10, flow: 0.15, state: null, fluctuation: 0.03, quality: 'medium', url:'https://pic.imgdb.cn/item/66e9380cf21886ccc0ca0060.png', des:'çµä»™å²›å²›æ°‘åœ¨ä»™äººé£å‡æˆåå‰ä¸€ç›´ä»¥æ•é±¼ä¸ºä¸šï¼Œé»‘è‰²æ°´åŸŸé è¿‘å²›å†…ï¼Œæ­¤å¤„ç››äº§å¤§é—¸èŸ¹ï¼Œä½†å¶å°”æœ‰æ¯’è›‡ä¼¤äººäº‹ä»¶' },
            {unit: 3, name: 'ç©ºå²›æ—…è¡Œä¼šç¤¾', threshold: 1500000, dealWeek: 3, quantity: 0, price: 60, basePrice: 60, flow: 3, state: null, fluctuation: 0.03, quality: 'medium', url:'https://pic.imgdb.cn/item/66ea482af21886ccc02b21b3.png', des:'å—å¤©ç©ºçœ·é¡¾çš„ä¸€æ—â€”â€”ç¾½æ—èšå±…åœ°ï¼Œæ­¤å¤„ç”±æ‚¬ç©ºæµ®å²›ç»„æˆï¼Œæ˜¯å¤©ä¹¦å¤§é™†æ—…æ¸¸ä¸šæœ€ç¹è£çš„åœ°æ–¹' },
            {unit: 4, name: 'é‡‘æ¸¯ç å¤´é›†å›¢', threshold: 3000000, dealWeek: 3, quantity: 0, price: 150, basePrice: 150, flow: 7, state: null, fluctuation: 0.03, quality: 'medium', url:'https://pic.imgdb.cn/item/66e9380cf21886ccc0ca0045.png', des:'ä½œä¸ºæœäº‘å›½æœ€ç¹åçš„æ¸¯å£ï¼Œæ˜¯èµ„æœ¬ä¸»ä¹‰èŒèŠ½çš„åœ°æ–¹ã€‚å¹¿è´Ÿç››åçš„æœäº‘å•†ä¼šåœ¨æ­¤åœ°é©»æ‰ï¼Œä»¤å¤–è´¸æˆä¸ºæœäº‘å›½çš„æ”¯æŸ±äº§ä¸šä¹‹ä¸€' },
            {unit: 5, name: 'çš‡åŸåœ°äº§æ§è‚¡', threshold: 5000000, dealWeek: 5, quantity: 0, price: 300, basePrice: 300, flow: 15, state: null, fluctuation: 0.03, quality: 'good', url:'https://pic.imgdb.cn/item/66e9380cf21886ccc0ca001a.png', des:'æ— è®ºè¿‡å»è¿˜æ˜¯æœªæ¥ï¼Œæˆ¿åœ°äº§éƒ½æ˜¯æ°¸æ’çš„ç‹ç‰Œ' },
            {unit: 6, name: 'æ˜Ÿä¹‹æµ·æ‰˜æ‹‰æ–¯', threshold: 10000000, dealWeek: 5, quantity: 0, price: 1000, basePrice: 1000, flow: 30, state: null, fluctuation: 0.03, quality: 'good', url:'https://pic.imgdb.cn/item/66e9380cf21886ccc0c9ffba.png', des:'å¤©ä¹¦å¤§èˆªæµ·æ—¶ä»£æ¥ä¸´ï¼ŒæŠ•èµ„ä½ çš„æµ·åº•æ˜é‡‘ä¼ä¸šï¼Œå¾æˆ˜æ˜Ÿè¾°å’Œå¤§æµ·' },
        ];
    }
    
    function resetDealWeek(stock) {
        const dealWeekOfStock = {
            'å½±æœˆåŠå·¥ä½œå®¤': 2,
            'é»‘æ°´æ°´äº§å•†è¡Œ': 3,
            'ç©ºå²›æ—…è¡Œä¼šç¤¾': 3,
            'é‡‘æ¸¯ç å¤´é›†å›¢': 3,
            'çš‡åŸåœ°äº§æ§è‚¡': 5,
            'æ˜Ÿä¹‹æµ·æ‰˜æ‹‰æ–¯': 5
        };
    
        // æ£€æŸ¥æ˜¯å¦æœ‰ 'èµ„æœ¬è¿ä½œ' è£…å¤‡
        const zibenyunzuo = scalpingState.gadgets.find(gadget => gadget === 'èµ„æœ¬è¿ä½œ');
        
        if (zibenyunzuo) {
            // å¯¹æ¯ä¸ªå…¬å¸åç§°å¯¹åº”çš„ dealWeek å€¼å‡å°‘ 1
            Object.keys(dealWeekOfStock).forEach(key => {
                if (dealWeekOfStock[key] > 1) {  // ç¡®ä¿ä¸å‡å°‘åˆ°å°äº 1
                    dealWeekOfStock[key] -= 1;
                }
            });
        }
    
        // è®¾ç½®å½“å‰è‚¡ç¥¨çš„ dealWeek
        stock.dealWeek = dealWeekOfStock[stock.name] || 0;  // å¦‚æœæ‰¾ä¸åˆ°å…¬å¸åï¼Œé»˜è®¤å€¼ä¸º 0
    
        console.log(stock.dealWeek);
    }
    
    let keyPhaseCount = 0;
            
    function updateStockPrice() {
        let info = [];
        let randomActivate = false;
        stockList.forEach(stock => {
            const basePrice = parseFloat(stock.basePrice) || 1;
            const caopanjubo = scalpingState.gadgets.find(gadget => gadget === 'æ“ç›˜å·¨æ“˜');
    
            let gadgetBonus = 0;
            if (caopanjubo) gadgetBonus = 3;
            
            if (scalpingState.currentSellingWeek > 30 && scalpingState.currentSellingWeek <= 36 + gadgetBonus) {
                
                stock.basePrice = enterStockKeyPhase(stock);
                
                if (basePrice < stock.basePrice) {
                    stock.state = 'higher';
                } else {
                    stock.state = 'lower';
                } 
                return;
            }
            
            // è®¡ç®—æ³¢åŠ¨å¹…åº¦ï¼Œç¡®ä¿æ³¢åŠ¨çš„æ–¹å‘æœ‰å¯èƒ½ä¸ºè´Ÿï¼ˆå³ä¸‹è·Œï¼‰
            const fluctuation = Math.random() * stock.fluctuation * (Math.random() < 0.5 ? -1 : 1);
            
            // ç´¯ç§¯å¢é•¿
            const fixedAccumulation = stock.flow;
    
            // æ ¹æ®è´¨é‡å†³å®šä»·æ ¼ä¸‹è·Œçš„æ¦‚ç‡
            const randomVal = Math.random();
            let ratio = 1;
            
            if (stock.quality === 'bad') {
                ratio = randomVal < 0.5 ? -1 : 1;  // bad è´¨é‡æœ‰ 50% å¯èƒ½è·Œä»·
            } else if (stock.quality === 'medium') {
                ratio = randomVal < 0.3 ? -1 : 1;  // medium è´¨é‡æœ‰ 30% å¯èƒ½è·Œä»·
            } else {
                ratio = randomVal < 0.1 ? -1 : 1;  // good è´¨é‡æœ‰ 10% å¯èƒ½è·Œä»·
            }
    
            // è®¡ç®—åŸºç¡€ä»·æ ¼ï¼Œæ³¢åŠ¨ä¸ç´¯ç§¯çš„å½±å“
            let stockPrice; 
    
            if (Math.random() < 0.05 && !currentInfoBox && !randomActivate) {
                stockPrice = basePrice + generateStockRandomEvent(stock);
                randomActivate = true;
            } else {
                stockPrice = basePrice + (basePrice * fluctuation * ratio) + (fixedAccumulation * ratio);
            }
            
            if (basePrice < stockPrice) {
                stock.state = 'higher';
            } else {
                stock.state = 'lower';
            }
            
            // ç¡®ä¿ä»·æ ¼ä¸ä¼šè·Œåˆ°è´Ÿæ•°
            stock.basePrice = Math.max(parseFloat(stockPrice.toFixed(2)), 0);
            info.push(`${stock.name}: ä¸Šå‘¨è‚¡ä»·${basePrice},æœ¬å‘¨è‚¡ä»·${stock.basePrice},è‚¡ä»·çŠ¶æ€ä¸º${stock.state === 'higher' ? 'æ¶¨' : 'è·Œ'}`);
            
            if (keyPhaseCount !== 0) keyPhaseCount = 0;
        });
        
        // console.log(info);
        updateStockPanelDisplay();
    }
    
    function enterStockKeyPhase(stock) {
        const goodPhase = calculateNetAsset() > 5000000;
        if (goodPhase) {
            stock.basePrice *= (Math.random() * 0.05 + 1.01);
        } else {
            stock.basePrice *= (Math.random() * 0.05 + 0.8);
        }
    
        if (keyPhaseCount === 0) {
            if (!currentInfoBox) {
                showMerchant(goodPhase ? 'ã€è¯åˆ¸è¦é—»ã€‘ç»æµå¼ºåŠ¿ï¼Œè¯åˆ¸å¸‚åœºè¿›å…¥ç‰›å¸‚å‘¨æœŸï¼' : 'ã€è¯åˆ¸è¦é—»ã€‘ç»æµè§æ¡ï¼Œè¯åˆ¸å¸‚åœºè¿›å…¥ç†Šå¸‚å‘¨æœŸï¼');
            } else {
                setTimeout(() => {
                    showMerchant(goodPhase ? 'ã€è¯åˆ¸è¦é—»ã€‘ç»æµå¼ºåŠ¿ï¼Œè¯åˆ¸å¸‚åœºè¿›å…¥ç‰›å¸‚å‘¨æœŸï¼' : 'ã€è¯åˆ¸è¦é—»ã€‘ç»æµè§æ¡ï¼Œè¯åˆ¸å¸‚åœºè¿›å…¥ç†Šå¸‚å‘¨æœŸï¼');
                }, 1000);
            }
            
            keyPhaseCount ++;
        }
        
        return parseFloat(stock.basePrice.toFixed(2)); //parseFloatå¤„ç†å°æ•°ï¼Œintå¤„ç†å­—ç¬¦ä¸²
    }
            
    function updateStockPanelDisplay() { 
        const upperArea = document.getElementById('scalping-upper-area');
        const middleWrapElement = document.getElementById('scalping-middle-wrap');
        if (middleWrapElement.style.display !== 'none') {
            return;
        }
        
        const existingStockPanel = document.getElementById('general-stock-panel');
        if (existingStockPanel) {
            upperArea.removeChild(existingStockPanel);
        }
    
        const stockPanel = document.createElement('div');
        stockPanel.id = 'general-stock-panel';
        stockPanel.style = 'display: flex;width: 90%;padding: 10px;border: 2px solid rgb(111, 57, 28);gap: 5px;max-height: 360px;overflow-y: scroll;flex-flow: column;background-image: url(https://pic.imgdb.cn/item/66da9042d9c307b7e9e14b2b.png);color: white;'; // è®¾ç½®è‚¡ç¥¨é¢æ¿æ˜¾ç¤º
        stockPanel.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹
    
        stockList.forEach(stock => {
            const stockDivContainer = document.createElement('div');
            stockDivContainer.id = `stock-${stock.unit}-container`;
            stockDivContainer.style = 'display: flex;flex-direction: row;justify-content: space-between;width: 100%;';
    
            // ä¼ä¸šåç§°éƒ¨åˆ†
            const stockDiv = document.createElement('div');
            stockDiv.style = 'display: flex;gap: 5px;flex-direction: row-reverse;align-items: center;font-size: 14px;cursor: pointer;width: 35%;justify-content: space-between;position: relative;'; // æ·»åŠ  position: relative
            stockDiv.innerText = `${stock.name}`;
            stockDiv.addEventListener('click', () => {
                showMerchant(`${stock.des}`);
            })
            stockDivContainer.appendChild(stockDiv);
            
            // ä¼ä¸šå›¾ç‰‡éƒ¨åˆ†
            const stockImg = document.createElement('img');
            stockImg.src = stock.url;
            stockImg.style.width = '45px';
            stockImg.style.height = '45px';
            stockImg.style.border = '1px solid black';
            stockDiv.appendChild(stockImg);
            
            // æ˜¾ç¤ºROIç™¾åˆ†æ¯”éƒ¨åˆ†
            const stockROI = document.createElement('div');
            stockROI.style.position = 'absolute';
            stockROI.style.top = '75%';
            stockROI.style.left = '20%';
            stockROI.style.transform = 'translate(-50%, -50%)'; // ä¿®æ­£æ‹¼å†™é”™è¯¯
            stockROI.innerText = `${(stock.basePrice >= stock.price ? 
                ((stock.basePrice - stock.price) / stock.price * 100).toFixed(1) : 
                ((stock.basePrice - stock.price) / stock.price * 100).toFixed(1))}%`;
            stockROI.style.textShadow = '-1px -1px 0 black, 1px -1px 0 black, -1px 1px 0 black, 1px 1px 0 black';
            stockROI.style.color = `${stock.price >= stock.basePrice ? 'lime' : '#FF4500'}`;
            stockROI.style.fontSize = '12px'; 
            stockROI.style.width = '45px'; 
            stockROI.style.textAlign = 'center'; 
            stockDiv.appendChild(stockROI); // å°† stockROI æ·»åŠ åˆ° stockDiv è€Œé stockImg
            
    
            // è‚¡ç¥¨è¯¦ç»†ä¿¡æ¯éƒ¨åˆ†
            const stockDetail = document.createElement('div');
            stockDetail.style = 'display: flex;gap: 10px;flex-direction: row;padding: 5px;align-items: center;font-size: 14px;width: 65%;justify-content: space-between;flex-wrap: nowrap;';
            stockDivContainer.appendChild(stockDetail);
    
            // è‚¡ç¥¨åŸºç¡€ä»·æ ¼
            const stockPrice = document.createElement('div');
            stockPrice.innerText = `${stock.basePrice}å…ƒ ${stock.state === 'higher' ? 'â†‘' : 'â†“'}`;
            stockPrice.style.color = `${stock.state === 'higher' ? '#FF4500' : 'lime'}`;
            stockDetail.appendChild(stockPrice);
    
            const stockOwned = document.createElement('div');
            stockOwned.innerText = `æŒæœ‰${stock.quantity}è‚¡`;
            stockDetail.appendChild(stockOwned);
    
            // è´­ä¹°æŒ‰é’®
            const buttonContainer = document.createElement('div');
            buttonContainer.style = 'display: flex;gap: 4px;flex-direction: column;width:45px;';
            
            const buyStockBtn = document.createElement('button');
            buyStockBtn.innerText = 'ä¹°å…¥';
            buyStockBtn.style = 'height: 22px;font-size: 12px;padding: 0;';
            buyStockBtn.addEventListener('click', () => {
                handleStockPurchase(stock);
                console.log('ä¹°å…¥è‚¡ç¥¨', stock.name);
            });
            buttonContainer.appendChild(buyStockBtn);
    
            const sellStockBtn = document.createElement('button');
            sellStockBtn.innerText = 'å–å‡º';
            sellStockBtn.style = 'height: 22px;font-size: 12px;padding: 0;';
            sellStockBtn.addEventListener('click', () => {
                handleStockSell(stock);
                console.log('å–å‡ºè‚¡ç¥¨', stock.name);
            });
            buttonContainer.appendChild(sellStockBtn);
            
            stockDetail.appendChild(buttonContainer);
            stockPanel.appendChild(stockDivContainer);
            upperArea.appendChild(stockPanel);
        });
    }
    
    function generateStockRandomEvent(stock) {
        const stockName = stock.name;
        const stockOriginalPrice = stock.basePrice;
        let stockPriceAfterEvent = stockOriginalPrice;
        const playerReputation = calculatePlayerReputation();
        const repBonus = playerReputation * 0.000001; //å®šä¹‰å£°æœ›çš„æ­£å‘å½±å“
    
        // éšæœºç”Ÿæˆæ˜¯å¥½äº‹ä»¶è¿˜æ˜¯åäº‹ä»¶ï¼Œ50%å‡ ç‡
        const isGoodEvent = Math.random() < Math.min(0.8, 0.5 + repBonus);
        let eventEffect = 0;
        let detail = '';
    
        const showDetail = () => {
            showInfoBox(`ã€è¯åˆ¸è¦é—»ã€‘${detail}`, null, null, `${isGoodEvent ? 'red' : 'green'}`, stock.url, '88px * 88px');
        };
    
        if (isGoodEvent) {
            // å¥½äº‹ä»¶ï¼šæ ¹æ® fluctuation å’Œ flow è°ƒæ•´ä»·æ ¼
            switch (stockName) {
                case 'å½±æœˆåŠå·¥ä½œå®¤':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 0.5 + 0.5) + stock.flow;
                    detail = `${stockName}åœ¨æ”¿åºœç¯ä¿æ”¿ç­–çš„æ‰¶æŒä¸‹ï¼Œæ¨å‡ºäº†ç»¿è‰²çººç»‡é¡¹ç›®ï¼Œå¾—åˆ°äº†å¸‚åœºçš„å¹¿æ³›æ¬¢è¿ï¼Œè‚¡ä»·å¼ºåŠ²ä¸Šæ¶¨: +${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'é»‘æ°´æ°´äº§å•†è¡Œ':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 0.7 + 0.3) + stock.flow;
                    detail = `${stockName}è¿‘æœŸå¤§é—¸èŸ¹çš„å¸‚åœºéœ€æ±‚å¤§å¢ï¼Œé”€é‡åˆ›ä¸‹æ–°é«˜ï¼Œå…¬å¸çš„æ”¶ç›Šå¤§å¹…å¢é•¿ï¼Œè‚¡ä»·å¼ºåŠ²ä¸Šæ¶¨: +${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'é‡‘æ¸¯ç å¤´é›†å›¢':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 1.0 + 0.5) + stock.flow;
                    detail = `${stockName}è·å¾—å¤§é‡çš„å›½é™…è´¸æ˜“è®¢å•ï¼Œå¤–è´¸ä¸šåŠ¡æ¿€å¢ï¼Œå¸¦æ¥äº†å¯è§‚çš„åˆ©æ¶¦ï¼Œè‚¡ä»·å¼ºåŠ²ä¸Šæ¶¨: +${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'ç©ºå²›æ—…è¡Œä¼šç¤¾':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 1.2 + 0.8) + stock.flow;
                    detail = `${stockName}çš„æ—…æ¸¸ä¸šåŠ¡åœ¨å‡æœŸé«˜å³°æœŸä¸­è“¬å‹ƒå‘å±•ï¼Œæ—…æ¸¸åŒºäººæ»¡ä¸ºæ‚£ï¼Œæ”¶å…¥å¤§å¹…å¢é•¿ï¼Œè‚¡ä»·å¼ºåŠ²ä¸Šæ¶¨: +${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'çš‡åŸåœ°äº§æ§è‚¡':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 1.5 + 1.0) + stock.flow;
                    detail = `${stockName}åœ¨æˆ¿åœ°äº§æ”¿ç­–å®½æ¾çš„èƒŒæ™¯ä¸‹ï¼ŒæŠ•èµ„çƒ­æ½®æ¨åŠ¨äº†åœ°äº§è‚¡çš„å¼ºåŠ²ä¸Šæ¶¨ï¼Œè‚¡ä»·å¼ºåŠ²ä¸Šæ¶¨: +${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'æ˜Ÿä¹‹æµ·æ‰˜æ‹‰æ–¯':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 2.0 + 1.5) + stock.flow;
                    detail = `${stockName}çš„æµ·åº•å¼€é‡‡æŠ€æœ¯å–å¾—çªç ´ï¼Œå¼€é‡‡æ•ˆç‡å¤§å¹…æé«˜ï¼Œåˆ©æ¶¦ç¿»å€ï¼Œè‚¡ä»·å¼ºåŠ²ä¸Šæ¶¨: +${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
            }
            stockPriceAfterEvent = eventEffect;
        } else {
            // åäº‹ä»¶ï¼šæ ¹æ® fluctuation å’Œ flow è°ƒæ•´ä»·æ ¼
            switch (stockName) {
                case 'å½±æœˆåŠå·¥ä½œå®¤':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 0.5 + 0.5) - stock.flow;
                    detail = `${stockName}çš„é‡ç”Ÿæ£®æ—èµ„æºé­åˆ°ç ´åï¼Œå¯¼è‡´çººç»‡åŸææ–™çŸ­ç¼ºï¼Œå…¬å¸ä¸šç»©ä¸‹æ»‘ï¼Œè‚¡ä»·å¤§å¹…ä¸‹è·Œ: ${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'é»‘æ°´æ°´äº§å•†è¡Œ':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 0.7 + 0.3) - stock.flow;
                    detail = `${stockName}çš„æ°´åŸŸå—åˆ°æ±¡æŸ“ï¼Œå¯¼è‡´æ°´äº§å‡äº§ï¼Œå…¬å¸åˆ©æ¶¦å¤§å¹…å‡å°‘ï¼Œè‚¡ä»·å¤§å¹…ä¸‹è·Œ: ${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'é‡‘æ¸¯ç å¤´é›†å›¢':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 1.0 + 0.5) - stock.flow;
                    detail = `${stockName}é­é‡å›½é™…è´¸æ˜“æ‘©æ“¦ï¼Œå‡ºå£è®¢å•å¤§å¹…å‡å°‘ï¼Œæ”¶å…¥éª¤å‡ï¼Œè‚¡ä»·å¤§å¹…ä¸‹è·Œ: ${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'ç©ºå²›æ—…è¡Œä¼šç¤¾':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 1.2 + 0.8) - stock.flow;
                    detail = `${stockName}çš„æ—…æ¸¸åŒºé­é‡äº†å¤©ç¾ï¼Œæ¸¸å®¢é‡é”å‡ï¼Œå…¬å¸æ”¶å…¥å—åˆ°ä¸¥é‡å½±å“ï¼Œè‚¡ä»·å¤§å¹…ä¸‹è·Œ: ${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'çš‡åŸåœ°äº§æ§è‚¡':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 1.5 + 1.0) - stock.flow;
                    detail = `${stockName}é­é‡æˆ¿åœ°äº§å¸‚åœºæ³¡æ²«ç ´è£‚ï¼ŒæŠ•èµ„è€…çº·çº·æ’¤èµ„ï¼Œè‚¡ä»·å¤§å¹…ä¸‹è·Œ: ${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
                case 'æ˜Ÿä¹‹æµ·æ‰˜æ‹‰æ–¯':
                    eventEffect = stock.fluctuation * stock.flow * (Math.random() * 2.0 + 1.5) - stock.flow;
                    detail = `${stockName}çš„æµ·åº•èµ„æºé€æ¸æ¯ç«­ï¼Œå¯¼è‡´å…¬å¸çš„å¼€é‡‡æˆæœ¬æ¿€å¢ï¼Œåˆ©æ¶¦æ€¥å‰§ä¸‹æ»‘ï¼Œè‚¡ä»·å¤§å¹…ä¸‹è·Œ: ${eventEffect.toFixed(2)}å…ƒã€‚`;
                    break;
            }
            stockPriceAfterEvent =  eventEffect;
        }
    
        // å±•ç¤ºè¯¦ç»†äº‹ä»¶ä¿¡æ¯
        showDetail();
    
        return stockPriceAfterEvent; // è¿”å›ä¸¤ä½å°æ•°çš„è‚¡ä»·
    }
            
    function handleStockPurchase(stock) {
        const revokeSandIndex = scalpingState.gadgets.indexOf('å”¤ç¥ç ‚');
        // å†æ£€æŸ¥ç©å®¶ç²¾åŠ›
        if (scalpingState.playerEnergy <= 60) {
            if (revokeSandIndex !== -1) {
                handleItemTransaction(item, null, 'purchase');
                // ä½¿ç”¨ splice æ¥åˆ é™¤ "å”¤ç¥ç ‚"
                scalpingState.gadgets.splice(revokeSandIndex, 1);
            } else {
                showMerchant('ä¸è¦è¿™ä¹ˆæ®šç²¾ç«­è™‘ï¼Œä½ éœ€è¦å¥½å¥½ä¼‘æ¯ä¸€ä¸‹ï¼');
            }
            return;
        }
        
        // æ£€æŸ¥ç”¨æˆ·çš„ç°é‡‘æ˜¯å¦è¶³å¤Ÿ
        if (scalpingState.currentCash < stock.threshold && stock.quantity < 1) {
            showMerchant(`æŠ•èµ„æœ‰é£é™©ï¼Œæ²¡æœ‰ä¸€å®šçš„æœ¬é‡‘æŠµå¾¡é£é™©å¯ä¸è¡Œï¼è¿™æ”¯è‚¡ç¥¨è¦æ±‚ä½ çš„æœ¬é‡‘è‡³å°‘ä¸º${stock.threshold}å…ƒï¼`);
            return;
        }
    
        // æ£€æŸ¥æ˜¯å¦å·²ç»æŒæœ‰å…¶ä»–è‚¡ç¥¨ï¼Œé¿å…åŒæ—¶æŠ•èµ„å¤šæ”¯è‚¡ç¥¨
        //const hasActiveStock = stockList.some(s => s.quantity !== 0 && s.name !== stock.name);
        //if (hasActiveStock) {
            //showMerchant('ç›®å‰ä½ å·²ç»æœ‰ä¸€æ”¯è‚¡ç¥¨åœ¨è¿ä½œï¼Œä¸èƒ½å†æŠ•èµ„å…¶ä»–ä¼ä¸šï¼');
            //return;
        //}
        
        if (stock.dealWeek > 0) {
            showInfoBox(`è¿™æ”¯è‚¡ç¥¨åœ¨æŠ•èµ„åéœ€è¦è‡³å°‘${stock.dealWeek}å‘¨åæ‰èƒ½è¿›è¡Œäº¤æ˜“ï¼Œç¡®è®¤è¯·ç»§ç»­`,
               () => handleStockTransaction(stock, 'purchase'),
               null,'red');
        } else {
            handleStockTransaction(stock, 'purchase');
        }
    }
    
    function handleStockSell(stock) {
        const revokeSandIndex = scalpingState.gadgets.indexOf('å”¤ç¥ç ‚');
        // å†æ£€æŸ¥ç©å®¶ç²¾åŠ›
        if (scalpingState.playerEnergy <= 60) {
            if (revokeSandIndex !== -1) {
                handleItemTransaction(item, null, 'purchase');
                // ä½¿ç”¨ splice æ¥åˆ é™¤ "å”¤ç¥ç ‚"
                scalpingState.gadgets.splice(revokeSandIndex, 1);
            } else {
                showMerchant('ä¸è¦è¿™ä¹ˆæ®šç²¾ç«­è™‘ï¼Œä½ éœ€è¦å¥½å¥½ä¼‘æ¯ä¸€ä¸‹ï¼');
            }
            return;
        }
    
        if (stock.dealWeek > 0) {
            showMerchant(`ä½ æŠ•èµ„çš„ä¼ä¸šè¿˜åœ¨å»ºè®¾ä¸­ï¼Œéœ€è¦${stock.dealWeek}å‘¨åæ‰èƒ½äº¤æ˜“ï¼`);
            return;
        }
            
        handleStockTransaction(stock);
    }
    
    function handleStockTransaction(item, actionType) {
        // åˆ¤æ–­è¡Œä¸ºç±»å‹ï¼šè´­ä¹°æˆ–å‡ºå”®
        const isPurchase = actionType === 'purchase';
    
        if (currentSlider) {
            document.body.removeChild(currentSlider);
            currentSlider = null;
        }
    
        // è·å–æˆ–åˆ›å»ºè¿›åº¦æ¡
        let sliderContainer = document.getElementById(`${actionType}-slider-container`);
        if (!sliderContainer) {
            sliderContainer = document.createElement('div');
            sliderContainer.id = `${actionType}-slider-container`;
            sliderContainer.style = 'display: flex;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);width: 80%;max-height: 80%;min-height: 10%;z-index: 9999;font-size: 14px;padding: 10px 20px 5px;background-color: rgb(223, 191, 110);color: rgb(146, 52, 28);background-image: url(https://pic.imgdb.cn/item/663885620ea9cb14033e4f6e.png);background-repeat: repeat;background-size: auto;box-shadow: rgb(30, 46, 47) 0px 0px 0px 1px, rgb(111, 57, 28) 0px 0px 0px 1px inset;border: 1px solid rgb(235, 172, 59);overflow-y: auto;flex-direction: column;align-items: center;gap: 5px;';
    
            const sliderLabel = document.createElement('label');
            sliderLabel.innerText = `æ‹–åŠ¨${isPurchase ? 'è´­ä¹°' : 'å‡ºå”®'}æ•°é‡ï¼š`;
            sliderContainer.appendChild(sliderLabel);
    
            const slider = document.createElement('input');
            slider.id = `${actionType}-slider`;
            slider.type = 'range';
            slider.min = 0;
            slider.max = 100;
            slider.value = 0;
            slider.style = 'width: 90%;appearance: none;border-radius: 20px;border: 1px groove #0475ff;box-shadow: inset 0px 0px 2px 1px #0475ff;';
            sliderContainer.appendChild(slider);
    
            const quantityLabel = document.createElement('div');
            quantityLabel.id = `${actionType}-quantity-label`;
            quantityLabel.innerText = `${isPurchase ? 'è´­ä¹°' : 'å‡ºå”®'}æ•°é‡: 0, é¢„è®¡é‡‘é¢: 0`;
            sliderContainer.appendChild(quantityLabel);
    
            const itemDescription = document.createElement('div');
            itemDescription.id = `${actionType}-item-description`;
            itemDescription.innerText = `ä¼ä¸šè¯´æ˜: ${item.des}`;
            sliderContainer.appendChild(itemDescription);
    
            const confirmButton = document.createElement('button');
            confirmButton.id = `confirm-${actionType}-button`;
            confirmButton.style = 'border: 1px solid #6F391C;background: linear-gradient(to bottom, #E47F47, #CE6633, #963D1C);box-shadow: inset 0px 0px 2px 1px #87431F;font-size: 14px;border-radius: 5px;color: #F9DE9B;padding: 4px 6px;cursor: pointer;transition: transform 0.1s, box-shadow 0.1s;';
            confirmButton.innerText = `ç¡®è®¤${isPurchase ? 'è´­ä¹°' : 'å‡ºå”®'}`;
            sliderContainer.appendChild(confirmButton);
            
            document.body.appendChild(sliderContainer);
        }
        
        sliderContainer.style.display = 'flex'; // æ˜¾ç¤ºè¿›åº¦æ¡
        const slider = document.getElementById(`${actionType}-slider`);
        const quantityLabel = document.getElementById(`${actionType}-quantity-label`);
        
        currentSlider = sliderContainer;
    
        let maxQuantity, price;
    
        if (isPurchase) {
            price = item.basePrice.toFixed(2); 
            maxQuantity = Math.floor(scalpingState.currentCash / price); // æœ€å¤§å¯è´­ä¹°æ•°é‡
        } else {
            price = item.basePrice.toFixed(2);
            maxQuantity = item.quantity || 0; // æœ€å¤§å¯å‡ºå”®æ•°é‡
        }
    
        // ç›‘å¬è¿›åº¦æ¡å˜åŒ–
        slider.addEventListener('input', (event) => {
            const percentage = event.target.value;
            const quantity = Math.floor((percentage / 100) * maxQuantity);
            const totalPrice = Math.floor(price * quantity);
        
            quantityLabel.innerText = `${isPurchase ? 'è´­ä¹°' : 'å‡ºå”®'} ${quantity} æ‰‹, é¢„è®¡é‡‘é¢: ${totalPrice}å…ƒ, ${isPurchase ? '' : `ç¨è´¹é¢„ä¼°ä¸º${(totalPrice * 0.1).toFixed(2)}å…ƒ`}`;
        });
    
        // ç‚¹å‡»ç¡®è®¤è´­ä¹°/å‡ºå”®
        document.getElementById(`confirm-${actionType}-button`).addEventListener('click', () => {
            const quantity = Math.floor((slider.value / 100) * maxQuantity);
            if (quantity > 0) {
                if (isPurchase) {
                    // æ‰§è¡Œè´­ä¹°é€»è¾‘
                    const totalCost = quantity * price;
                    scalpingState.currentCash -= Math.floor(totalCost);
                    item.quantity += quantity;
         
                    updateScalpingPanel();
                    updateStockPanelDisplay();
                } else {
                    // æ‰§è¡Œå‡ºå”®é€»è¾‘
                    const totalSaleValue = quantity * price;
                    const kaimanzhizhao = scalpingState.gadgets.find(gadget => gadget === 'å¼€æ›¼å²›æ‰§ç…§');
                    
                    let incomeAfterTaxRatio = 0.9;
                    if (kaimanzhizhao) incomeAfterTaxRatio = 0.95;
                    
                    scalpingState.currentCash += Math.floor(totalSaleValue * incomeAfterTaxRatio);
                    item.quantity -= quantity;
    
                    if (item.quantity === 0) resetDealWeek(item);
                    if (stockList.filter(s => s.quantity > 0).length === 1) {
                        document.getElementById('stock-info-display').innerText = `å½“å‰æŒæœ‰${item.quantity}æ‰‹${item.name}çš„è‚¡ç¥¨`;
                    } else {
                        document.getElementById('stock-info-display').innerText = `å½“å‰æ€»è®¡æŒæœ‰${stockList.filter(s => s.quantity > 0).length}æ”¯è‚¡ç¥¨`;
                    }
                    updateScalpingPanel();
                    updateStockPanelDisplay();
                }
                sliderContainer.style.display = 'none'; // å®Œæˆåéšè—è¿›åº¦æ¡
            } else if (currentSlider) {
                    document.body.removeChild(currentSlider);
                    currentSlider = null;
            }
        });
    }
        
    //å€’ä¹°å€’å–çš„é€»è¾‘
    function openScalping(closeButton = false) {
        const scalpingWindow = document.getElementById('scalping-display');
        const isOpen = scalpingWindow.style.display === 'flex';
        const toggleWindow = () => {
            scalpingWindow.style.display = isOpen ? 'none' : 'flex'; // æ ¹æ®çŠ¶æ€åˆ‡æ¢æ˜¾ç¤º
            updateScalpingPanel();
        };
    
        if (closeButton) {
            toggleWindow(); // ç‚¹å‡»å…³é—­æŒ‰é’®æ—¶ï¼Œç›´æ¥åˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€
            return;
        }
    
        showInfoBox(
            'ä½ è¦èŠ±å¤šé•¿æ—¶é—´ï¼Œæ‰èƒ½èµšåˆ°ä¸€ä¸ªå°ç›®æ ‡ï¼Ÿ\n\näººç”Ÿåœ¨ä¸–ï¼Œåˆ©å­—å½“å¤´ã€‚é€é¹¿æ²™åœºå›ºç„¶æ¾æ¹ƒï¼Œå•†åœºæ²‰æµ®äº¦ä»¤äººæ‰§è¿·ã€‚\n\nåœ¨è¿™ä¸ªç•Œé¢å†…ï¼Œä½ å°†èŠ±è´¹ä¸€å¹´æ—¶é—´ï¼ˆ52å‘¨ï¼‰ä½“éªŒæŠ•èµ„çš„ç»å† \n\nä¸­é€”ç¦»å¼€ä¸ä¼šåˆ é™¤æ•°æ®ï¼Œä½†åˆ·æ–°é¡µé¢ä¼šæ¸…ç©ºä½ çš„ä»“åº“å’Œèµ„äº§ï¼Œè¯·çŸ¥æ‚‰ \n\næ¸¸æˆç»“æŸåå°šæœªå˜ç°çš„èµ„äº§ï¼ˆä»“åº“è´§ç‰©ï¼‰åœ¨æ¸¸æˆç»“æŸæ—¶å°†ä¼šä»¥ä¸€å®šæŠ˜æ‰£è¿›è¡Œå˜å–',
            toggleWindow  // ä¿¡æ¯æ¡†ç¡®è®¤åï¼Œæ‰§è¡Œçª—å£åˆ‡æ¢
        );
    }
    
    function showInfoScalping() {
        const comment = updateHighestAssetDisplay(highestAsset, false) || 'ç›®å‰ä½ è¿˜æ²¡æœ‰æ”¶åˆ°ä»»ä½•è¯„ä»·ï¼';
        const message = `
            æ¬¢è¿æ¥åˆ°è‡ªç”±ç»å•†çš„åŠŸèƒ½é¢æ¿ï¼å½“å‰ä½ çš„æœ€é«˜è®°å½•æ˜¯${highestAsset.toLocaleString('en-US')}å…ƒï¼Œå•†ç•Œäººå£«å¯¹ä½ çš„è¯„ä»·æ˜¯ï¼š${comment}ï¼
            
            1. ä½ å¯ä»¥åœ¨æ­¤å¤„åˆ·æ–°å•†å“ï¼Œåœ¨ä½ä½æ—¶è´­å…¥ï¼Œé«˜ä½æ—¶æœæ–­æŠ›å‡ºã€‚
            2. æ¯æ¬¡ç»å•†æ—¶é•¿ä¸º52å‘¨ï¼Œæ¯å‘¨ä¼šæ ¹æ®ä»“åº“å®¹é‡æ”¶å–ä¸€å®šç§Ÿé‡‘ã€‚
            3. æ¯å‘¨å¸‚é¢ä¸Šçš„é“å…·å’Œéœ€æ±‚éƒ½ä¼šå˜åŒ–ï¼Œè¿˜ä¼šæœ‰å„ç§éšæœºäº‹ä»¶å½±å“ä»·æ ¼ã€‚
            4. ä½ å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»è¡¥å……ä½ çš„å¯åŠ¨èµ„é‡‘ã€‚
            5. ä½¿ç”¨æ³•å®å¯ä»¥è®©ä½ çš„ç»å•†ä¹‹è·¯æ›´åŠ é¡ºåˆ©ã€‚
            6. ç»å•†æ—¶é—´ç»“æŸæ—¶ï¼Œå°†æ— æ³•å†åˆ·æ–°é“å…·ã€‚
            7. ä»“åº“çš„è´§å“ã€æœªå‡ºå”®çš„è‚¡ç¥¨åœ¨æ¸¸æˆç»“æŸæ—¶ï¼Œä¼šä½œä¸ºæœªå˜ç°èµ„äº§äº§ç”ŸæŠ˜æ‰£
            7. å¦‚æœä¸æƒ³ç©äº†ï¼Œå¯ä»¥ç‚¹å‡»æå‰é€€å¸‚è®¡ç®—æ”¶ç›Šï¼Œä½†ä¼šå—åˆ°ä¸€å®šçš„è¿çº¦é‡‘æƒ©ç½šã€‚
            8. ç°é‡‘ç§¯ç´¯åˆ°ä¸€å®šç¨‹åº¦ï¼Œå¯ä»¥å°è¯•æŠ•èµ„è‚¡ç¥¨ã€‚
            9. åœ¨ç»å•†é¢æ¿è´­ä¹°çš„å•†å“éƒ½åªä¾›é”€å”®ä½¿ç”¨å“¦ã€‚`;
        showMerchant(message);
    }
            
    function increaseInverstment() {
        if (goldAmount >= 50000) {
            showInfoBox(`\nåœ¨è‡ªç”±å¸‚åœºï¼Œ1æ–‡é‡‘å­=1å…ƒï¼Œæ¯æ¬¡æœ€å°‘æŠ•èµ„50000å…ƒã€‚\n\nå½“æ€»èµ„äº§åˆ°è¾¾20ä¸‡æˆ–æŠ•èµ„æ¬¡æ•°è¾¾åˆ°5æ¬¡æ—¶ï¼Œå°†ä¸å…è®¸è¿½åŠ æŠ•èµ„ã€‚\n\nä½ è¿˜å¯ä»¥æŠ•èµ„${Math.max(0, 5-scalpingState.investmentCount)}æ¬¡ï¼Œå‡†å¤‡å¥½æ³¨èµ„50000å…ƒäº†å—ï¼Ÿ`,
                       () => {
                           if (scalpingState.investmentCount >= 5) {
                               showMerchant('æœ¬å¹´åº¦æŠ•èµ„æ¬¡æ•°å·²ç»è€—å°½ï¼');
                               return;
                           }
                           
                           if (calculateNetAsset() >= 200000) {
                               showMerchant('å½“å‰æ€»èµ„äº§è¶…è¿‡20ä¸‡ï¼Œä¸æ”¯æŒå¤©ä½¿æŠ•èµ„ï¼');
                               return;
                           } else {
                               goldAmount -= 50000;
                               scalpingState.currentCash += 50000;
                               scalpingState.investmentCount ++;
                               updateScalpingPanel();
                               updateGoldDisplay(goldAmount);
                               showMerchant('æ³¨å…¥ä¸€ç¬”å¤©ä½¿æŠ•èµ„ï¼Œç¥ä½ çš„ç”Ÿæ„åšå¤§åšå¼ºï¼');
                           }
                       },
                       () => {
                           showMerchant('å–æ¶ˆæ³¨èµ„ï¼');
                       },
                       null,
                       'https://pic.imgdb.cn/item/66e32523d9c307b7e995cf28.png',
                       '88px * 88px');
        } else {
            showMerchant('ä½ çš„å¯åŠ¨èµ„é‡‘è¿˜ä¸è¶³50ä¸¤é‡‘å­ï¼Œå°šä¸èƒ½æˆä¸ºå¤©ä½¿æŠ•èµ„äºº');
        }
    }
    
    function closeGagdetsPanel() {
        const gadgetsContainer = document.getElementById('gadgets-selector');
        gadgetsContainer.style.display = 'none';
    }
    
    function selectSaclpingGadgets() {
        const gadgets = jinnangItems.filter(item => item.description.includes('ã€ç»å•†æ³•å®ã€‘') && item.quantity >= 1);
        const gadgetsWholeContainer = document.getElementById('gadgets-selector');
        const gadgetsContainer = document.getElementById('selected-gadgets');
        gadgetsContainer.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹
        
        // ä½¿ç”¨ gadgets æ•°ç»„ç›´æ¥ï¼Œä¸éœ€è¦é¢å¤–èµ‹å€¼ç»™ selectedGadgets
        if (gadgets.length === 0) {
            showMerchant('æš‚æ—¶æ²¡æœ‰å¯ç”¨æ³•å®ï¼Œä½ å¯ä»¥åœ¨æ³•å®å•†åº—ä½¿ç”¨ç»å•†ç§¯åˆ†è¿›è¡Œè´­ä¹°');
        }
        gadgetsWholeContainer.style.display = 'flex';
        
        gadgets.forEach(gadget => {
            const gadgetElement = document.createElement('div');
            gadgetElement.className = 'selected-gadgets';
            gadgetElement.style = 'display: flex;justify-content: space-between;font-size: 14px;align-items: center;margin-bottom: 10px;border: 1px solid #6f391c;padding: 5px;';
            gadgetElement.innerHTML = `
                <div id="${gadget.name}-container" style="cursor: pointer;margin-right: 10px;width: 20%;height: 100%;">
                    <img src="${gadget.url}" alt="${gadget.name}" style="width: 45px; height: 45px; border: 1px solid #6f391c" />
                    <div>${gadget.displayName}</div>
                </div>
                <div id="description-${gadget.name}" style="width: 80%;height: 100%;text-align: start;">${gadget.description}ï¼Œæ‹¥æœ‰ï¼š${gadget.quantity}ä¸ª </div>
            `;
    
            // ç‚¹å‡»æ³•å®æ—¶å¼¹å‡ºåº”ç”¨é¢æ¿
            gadgetElement.addEventListener('click', () => {
                const appliedGadgetsContainer = document.getElementById('applied-scalping-gadgets');
                // ä¿®æ”¹ä¸º < 3ï¼Œé¿å…ç­‰äº3æ—¶ç»§ç»­æ·»åŠ 
                if (scalpingState.gadgets.length < 3 && !scalpingState.gadgets.includes(gadget.displayName)) {
                    scalpingState.gadgets.push(gadget.displayName);
                    const appliedGadgetsElement = document.createElement('div');
                    appliedGadgetsElement.style = 'display: flex;justify-content: space-between;align-items: center;font-size: 14px;';
                    
                    // ä¿®å¤ï¼šåªæ›´æ–°å­å…ƒç´ ï¼Œè€Œä¸æ˜¯æ•´ä¸ª gadgetElement çš„å†…å®¹
                    const imgElement = document.createElement('img');
                    imgElement.src = gadget.url;
                    imgElement.alt = gadget.name;
                    imgElement.style = 'width: 25px; height: 25px; border: 1px solid #6f391c; cursor: pointer;';
                    appliedGadgetsElement.appendChild(imgElement);
                    imgElement.addEventListener('click',() => {
                        showMerchant(`${gadget.description}`);
                    })
                    
                    appliedGadgetsContainer.appendChild(appliedGadgetsElement);
                    gadgetsWholeContainer.style.display = 'none';
                    useItem(`${gadget.name}`,1);
                    showMerchant(`ä½ æˆåŠŸåº”ç”¨äº†${gadget.displayName}!`);
                    applyGadgetEffect(gadget);
                    updateScalpingPanel();
                } else {
                    showMerchant('å½“å‰æ³•å®åº”ç”¨æ•°é‡å·²è¾¾ä¸Šé™æˆ–å·²æœ‰åŒç±»æ³•å®ç”Ÿæ•ˆï¼');
                }
            });
    
            gadgetsContainer.appendChild(gadgetElement);
            
        });
    }
    
    function applyGadgetEffect(gadget) {
        const appliedGadget = scalpingState.gadgets.find(g => g === gadget.displayName);
    
        if (!appliedGadget) {
            console.error(`æœªæ‰¾åˆ°æ³•å®: ${gadget}`);
            return;
        }
        const gadgetEffects = {
            'ç»­ç§Ÿå¥‘': () => {
                scalpingState.maxSellingWeek += 4;
                updateScalpingPanel();
            },
            'ç‰¹è®¸æ‹›å•†ä»¤': () => {
                scalpingState.investmentCount -= 1;
                updateScalpingPanel();
            },
            'èµ„æœ¬è¿ä½œ': () => {
                stockList.forEach(stock => {
                    if (stock.dealWeek > 1) {
                        stock.dealWeek -= 1;
                    }
                });
                updateScalpingPanel();
            }
        };
    
        // æ£€æŸ¥æ³•å®æ˜¯å¦æœ‰å¯¹åº”çš„æ•ˆæœå¹¶è°ƒç”¨
        if (gadgetEffects[appliedGadget]) {
            gadgetEffects[appliedGadget]();
        } else {
            console.error(`æ²¡æœ‰æ‰¾åˆ° ${appliedGadget} çš„æ•ˆæœå®šä¹‰`);
        }
    }
    
    function exchangeGadgets() {
        const storeElement = document.getElementById('gadget-store-panel');
        storeElement.style.display = 'flex';
        updateGadgetStorePanel();
    }     
    
    function updateGadgetStorePanel() {
        const gadgets = jinnangItems.filter(item => item.description.includes('ã€ç»å•†æ³•å®ã€‘'));
        const gadgetItemsArea = document.getElementById('gadget-items');
        gadgetItemsArea.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹
    
        const gadgetPrice = [
            {name: 'å…«æ–¹æ¥è´¢', price: 6000},
            {name: 'å¼ºèº«æ•£', price: 4500},
            {name: 'è‹±é›„ä»¤', price: 4500},
            {name: 'ç»­ç§Ÿå¥‘', price: 16000},
            {name: 'çå®æ¡ˆ', price: 3000},
            {name: 'ç‰¹è®¸æ‹›å•†ä»¤', price: 3000},
            {name: 'å›½å¯Œè®º', price: 15000},
            {name: 'å”¤ç¥ç ‚', price: 2000},
            {name: 'ä¹¾å¤è¢‹', price: 2500},
            {name: 'åŒå–œä¸´é—¨', price: 3000},
            {name: 'èµ„æœ¬è¿ä½œ', price: 7000},
            {name: 'å¼€æ›¼å²›æ‰§ç…§', price: 7000},
            {name: 'å®¶æ—ä¿¡æ‰˜', price: 8000},
            {name: 'æ“ç›˜å·¨æ“˜', price: 18000},
            {name: 'ç™¾è¾¾ç¿¡ä¸½', price: 25000}
        ];
    
        // å¯¹ gadgets æŒ‰ç…§ä»·æ ¼ä»ä½åˆ°é«˜è¿›è¡Œæ’åº
        gadgets.sort((a, b) => {
            const priceA = gadgetPrice.find(p => p.name === a.displayName)?.price || 0;
            const priceB = gadgetPrice.find(p => p.name === b.displayName)?.price || 0;
            return priceA - priceB;
        });
    
        // ç”Ÿæˆ gadget å…ƒç´ 
        gadgets.forEach(gadget => {
            const priceInfo = gadgetPrice.find(p => p.name === gadget.displayName);
            const price = priceInfo ? priceInfo.price : 'æœªçŸ¥'; // å¦‚æœæ‰¾ä¸åˆ°ä»·æ ¼åˆ™æ˜¾ç¤º"æœªçŸ¥"
    
            const gadgetElement = document.createElement('div');
            gadgetElement.className = 'selected-gadgets';
            gadgetElement.style = 'display: flex; justify-content: space-between; font-size: 14px; align-items: center; margin-bottom: 10px; border: 1px solid rgb(111, 57, 28); padding: 5px;';
            gadgetElement.innerHTML = `
                <div id="${gadget.name}-container" style="cursor: pointer;margin-right: 10px;width: 20%;height: 100%;">
                    <img src="${gadget.url}" alt="${gadget.name}" style="width: 45px; height: 45px; border: 1px solid #6f391c" />
                    <div>${gadget.displayName}</div>
                </div>
                <div id="description-${gadget.name}" style="width: 80%;height: 100%;text-align: start;">${gadget.description}ï¼Œå”®ä»·ï¼š${price} ç§¯åˆ†ã€‚</div>
            `;
            gadgetItemsArea.appendChild(gadgetElement);
    
            gadgetElement.addEventListener('click', () => {
                if (price === 'æœªçŸ¥') {
                    showMerchant('æ­¤æ³•å®æ— æ³•è´­ä¹°ï¼Œä»·æ ¼æœªçŸ¥ï¼');
                    return;
                }
    
                showInfoBox(`æ˜¯å¦èŠ±è´¹${price}ç§¯åˆ†è´­ä¹°ä¸€ä¸ª${gadget.displayName}ï¼Ÿ`,
                           () => {
                               if (scalpingScore < price) {
                                   showMerchant('ä½ çš„ç»å•†ç§¯åˆ†ä¸è¶³ï¼è¯·å¤šå¤šä½¿ç”¨ç»å•†åŠŸèƒ½ç§¯ç´¯ç§¯åˆ†ï¼');
                               } else {
                                   scalpingScore -= price;
                                   addItemToJinnang(gadget.name, 1);
                                   showMerchant(`æˆåŠŸèŠ±è´¹${price}ç§¯åˆ†è´­ä¹°ä¸€ä¸ª${gadget.displayName}ï¼å‰©ä½™ç§¯åˆ†${scalpingScore}ã€‚`);
                                   selectSaclpingGadgets();
                                   updateScalpingPanel(); // åœ¨æˆåŠŸè´­ä¹°åæ›´æ–°é¢æ¿
                               }
                           },
                           null, null, 'https://pic.imgdb.cn/item/66e32523d9c307b7e995cf28.png', '88px * 88px');
            });
        });
    }
    
    function addItemToJinnang(itemName, quantity = 1) {
        let item = jinnangItems.find(i => i.name === itemName);
        if (item) {
            item.quantity += quantity;
        } else {
            showMerchant('ä½ åšäº†ä¸è¯¥åšçš„äº‹æƒ…ï¼');
        }
    }

    function useItem(itemName, quantity = 1) {
        const itemIndex = jinnangItems.findIndex(item => item.name === itemName);
        if (itemIndex !== -1 && jinnangItems[itemIndex].quantity >= quantity) {
            jinnangItems[itemIndex].quantity -= quantity;
            if (jinnangItems[itemIndex].quantity < 0) {
                jinnangItems[itemIndex].quantity = 0;
            }
            return true;
        }
        showInfoBox("é“å…·æ•°é‡ä¸è¶³æˆ–æœªæ‰¾åˆ°è¯¥é“å…·");
        return false;
    } 

    document.getElementById('close-gagdet-store').addEventListener('click', () => {
        const storeElement = document.getElementById('gadget-store-panel');
        storeElement.style.display = 'none';
    })
            
    // æ ¹æ®æ³¢åŠ¨è®¡ç®—å•†å“ä»·æ ¼
    function getScalpableItemsPrice(item, isSpecial = false) {
        let fluctuationRange = 0;
        let price = 0;
        const playerReputation = calculatePlayerReputation();
        const repBonus = playerReputation * 0.000001; //å®šä¹‰å£°æœ›çš„æ­£å‘å½±å“
        if (isSpecial) {
            if (Math.random() < Math.min(0.8, 0.5 + repBonus)) {
                fluctuationRange = item.basePrice * item.fluctuation;
                price = Math.floor((item.basePrice + (Math.random() * (2 * fluctuationRange) - fluctuationRange)) * 0.2 * item.downRate);
                showMerchant(`${item.badEvent}`);
            } else {
                fluctuationRange = item.bonusPrice * item.fluctuation;
                price = item.bonusPrice + (Math.random() * (2 * fluctuationRange) - fluctuationRange);
                showMerchant(`${item.goodEvent}`);
            }
        } else {
            fluctuationRange = item.basePrice * item.fluctuation;
            price = item.basePrice + (Math.random() * (2 * fluctuationRange) - fluctuationRange);
        }
    
        return Math.floor(price);
    }
    
    function generateItemToDisplay() {
        if (scalpingState.currentSellingWeek !== 0) {
            showMerchant('æ­£åœ¨æœ¬å¹´åº¦çš„å•†å“è¿ä½œä¸­ï¼Œæ— æ³•æ›´æ¢å•†å“ï¼');
            return;
        }
        const selectedItems = scalpingItems.filter(i => i.itemActivate);
        const parentPanel = document.getElementById('scalping-display');
        const existingPanel = document.getElementById('select-scalping-item-panel');
        if (existingPanel) parentPanel.removeChild(existingPanel);
    
        const selectPanel = document.createElement('div');
        selectPanel.id = "select-scalping-item-panel";
        selectPanel.innerText = `è¯·ä¸ºä½ çš„ä¼ä¸šé€‰å“ ${selectedItems.length} / 6`;
        selectPanel.style = "flex-flow: wrap;gap: 10px;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);width: 100%;display: flex;background: url('https://pic.imgdb.cn/item/66ea60acf21886ccc04b6877.jpg') center center / cover no-repeat rgba(0, 0, 0, 0.8);padding: 2px;border-radius: 2px;color: #fff;font-size: 16px;height: 100%;align-items: center;place-content: center;text-shadow: -1px -1px 0 black, 1px -1px 0 black, -1px 1px 0 black, 1px 1px 0 black;";
    
        const selectPanelContainer = document.createElement('div');
        selectPanelContainer.style = "display: grid;grid-template-columns: repeat(4, 1fr);align-content: space-between;width: 100%;justify-items: center;background-color: rgba(0, 0, 0, 0.1);height: 360px;overflow-y: scroll;";
        
        const closeBtn = document.createElement('button');
        closeBtn.style = 'border: 1px solid rgb(111, 57, 28);background: linear-gradient(rgb(228, 127, 71), rgb(206, 102, 51), rgb(150, 61, 28));box-shadow: rgb(135, 67, 31) 0px 0px 2px 1px inset;font-size: 14px;border-radius: 5px;color: rgb(249, 222, 155);padding: 4px;cursor: pointer;transition: transform 0.1s, box-shadow 0.1s;';
        closeBtn.innerText = 'å…³é—­çª—å£';
        closeBtn.addEventListener('click', () => {
            parentPanel.removeChild(selectPanel);
        });
        selectPanel.appendChild(closeBtn);
        
        scalpingItems.forEach(item => {
            // åˆ›å»ºå®¹å™¨
            const itemContainer = document.createElement('div');
            itemContainer.id = `${item.name}-option`;
            itemContainer.style = "display: flex;height: 100px;width: 80px;flex-flow: column;justify-content: space-between;padding: 5px;gap: 2px;align-items: center;";
            
            // åˆ›å»ºå†…éƒ¨å®¹å™¨
            const innerContainer = document.createElement('div');
            innerContainer.style = "display: flex;flex-direction: column;align-items: center;align-content: center;justify-content: space-between;flex-wrap: wrap;text-wrap: nowrap;text-overflow: ellipsis;gap: 5px; font-size:14px;";
            
            // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
            const imgElement = document.createElement('img');
            imgElement.src = item.url;
            imgElement.alt = item.name;
            imgElement.style.width = "45px";
            imgElement.style.height = "45px";
            imgElement.style.cursor = "pointer";
            imgElement.style.border = "1px solid black";
            imgElement.style.boxShadow = `${item.itemActivate? '#f5fffa 0px 0px 2px 2px' : ''}`;
            imgElement.addEventListener('click', () => {
                showMerchant(`${item.name}: å•å“å‡ä»·${item.basePrice}å…ƒ, ä¸€èˆ¬æ³¢åŠ¨è¾ƒ${item.fluctuation <= 0.2 && item.downRate <= 1.5 ? 'å°' : 'å¤§'}ã€‚ç‰¹æ®Šæƒ…å†µä¸‹å±äº${item.bonusPrice >= item.basePrice * 3 ? 'é£æŠ•äº§å“ï¼Œé£é™©ä¸æ”¶ç›Šå¹¶å­˜' : 'ä¸€èˆ¬äº§å“ï¼Œå¯ç”¨äºèµ„äº§ä¿å€¼'}ã€‚`);
            })
            
            // åˆ›å»ºæ–‡æœ¬å…ƒç´ 
            const nameDiv = document.createElement('div');
            nameDiv.textContent = item.name;
            
            // ç»„è£…å…ƒç´ 
            innerContainer.appendChild(imgElement);
            innerContainer.appendChild(nameDiv);
            itemContainer.appendChild(innerContainer);
    
            const activateBtn = document.createElement('button');
            activateBtn.id = `${item.name}-activate-button`;
            activateBtn.style = 'border: 1px solid rgb(111, 57, 28);background: linear-gradient(rgb(228, 127, 71), rgb(206, 102, 51), rgb(150, 61, 28));box-shadow: rgb(135, 67, 31) 0px 0px 2px 1px inset;fon;font-size: 14px;border-radius: 5px;color: rgb(249, 222, 155);padding: 4px;cursor: pointer;transition: transform 0.1s, box-shadow 0.1s;';
            activateBtn.innerText = `${item.itemActivate ? 'å–æ¶ˆ' : 'æ¿€æ´»'}`;
            activateBtn.addEventListener('click', () => {
                if (!item.itemActivate && selectedItems.length < 6) {
                    item.itemActivate = true;
                    showMerchant(`å·²æ¿€æ´»${item.name}ã€‚`);
                    activateBtn.innerText = 'å–æ¶ˆ';
                    generateItemToDisplay();
                } else if (item.itemActivate) {
                    item.itemActivate = false;
                    showMerchant(`å·²å–æ¶ˆå”®å–${item.name}ã€‚`);
                    activateBtn.innerText = 'æ¿€æ´»';
                    generateItemToDisplay();
                } else {
                    showMerchant('åªèƒ½åŒæ—¶è¿ä½œ6ä¸ªå•†å“ï¼');
                }
            });
            itemContainer.appendChild(activateBtn);
            selectPanelContainer.appendChild(itemContainer);
    
        });
        selectPanel.appendChild(selectPanelContainer);
        parentPanel.appendChild(selectPanel);
    }
            
    // ç”Ÿæˆéšæœºå•†å“å¹¶å±•ç¤ºåˆ°å¸‚åœºæ¿å—
    function getRandomScalpableItem() {    
        const marketPanel = document.getElementById('scalping-item-info');
        marketPanel.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹
        let specialEvents = false;
    
        // éšæœºé€‰æ‹©1åˆ°4ä¸ªå•†å“
        const itemsToDisplay = [];
        const wealthOfNations = scalpingState.gadgets.find(gadget => gadget === 'å›½å¯Œè®º');
        let itemToAdd = 0;
    
        if (wealthOfNations) itemToAdd = 1;
        const numberOfItems = Math.min(5, Math.floor(Math.random() * 5) + 1 + itemToAdd);
        const selectedItems = scalpingItems.filter(i => i.itemActivate);
    
        
        while (itemsToDisplay.length < numberOfItems) {
            const randomItem = selectedItems[Math.floor(Math.random() * selectedItems.length)];
            if (!itemsToDisplay.includes(randomItem)) {
                itemsToDisplay.push(randomItem);
            }
        }
    
        // ç”ŸæˆHTMLç»“æ„
        itemsToDisplay.forEach(item => {
            const originalPrice = document.getElementById(`price-${item.name}`) ? parseInt(document.getElementById(`price-${item.name}`).innerText) : item.basePrice;
            let price = getScalpableItemsPrice(item);
            let rareEventChance = 0.1;
            const rareEventBooster = scalpingState.gadgets.find(gadget => gadget === 'å…«æ–¹æ¥è´¢');
    
            if (rareEventBooster) {
                rareEventChance = 0.2;
            }
    
            // æ£€æŸ¥æ˜¯å¦è§¦å‘ç‰¹æ®Šäº‹ä»¶
            if (Math.random() < rareEventChance && !specialEvents) {
                price = getScalpableItemsPrice(item, true);  // ç‰¹æ®Šäº‹ä»¶ä»·æ ¼
                specialEvents = true;  // æ ‡è®°å·²ç”Ÿæˆç‰¹æ®Šäº‹ä»¶
            }
    
            // åˆ›å»ºå•†å“å…ƒç´ 
            const itemElement = document.createElement('div');
            itemElement.className = 'scalping-item';
            itemElement.style = 'display: flex;justify-content: space-between;align-items: center;font-size: 14px;';
            itemElement.innerHTML = `
                <div id="${item.name}-container" style="cursor: pointer;">
                    <img src="${item.url}" alt="${item.name}" style="width: 45px; height: 45px; border: 1px solid #6f391c" />
                    <div>${item.name}</div>
                </div>
                <div id="price-${item.name}" style="color:${price > originalPrice? '#FF4500' : 'lime'};">${price}å…ƒ ${price > originalPrice? 'â†‘' : 'â†“'}</div>
            `;
    
            // ç‚¹å‡»å•†å“æ—¶å¼¹å‡ºè´­ä¹°è¿›åº¦æ¡
            itemElement.addEventListener('click', () => {
                handleItemPurchase(item, price);
                });
    
            marketPanel.appendChild(itemElement);
        });
    }
    
    //æ„é€ çš„ç®€ä¾¿æ¶ˆæ¯å‡½æ•°ï¼Œä»…ç”¨äºå€’ä¹°å€’å–
    function showMerchant(message) {
        const merchantUrl = 'https://pic.imgdb.cn/item/66e32523d9c307b7e995cf28.png';
        const merchantSize = '88px * 88px';
    
        showInfoBox(message,null,null,null,merchantUrl,merchantSize);
    }
    
    function getReputationAndShareEvent() {
        const reputation = calculatePlayerReputation();
        const repEvents = [
            {value: 1000, cashIn: 1000, description: 'è¡Œèµ°å•†åœº,å°æœ‰åæ°”,å­£åº¦å•†åœºæ–°äººå¥–é¢å‘ç»™ä½ '},
            {value: 5000, cashIn: 5000, description: 'å´­éœ²å¤´è§’çš„å°å•†è´©â€”â€”ä¸å¯¹,å°å•†è´©å·²ç»ä¸èƒ½ç§°å‘¼ä½ äº†,åº”è¯¥å«ä½ è€æ¿å…ˆç”Ÿ'},
            {value: 10000, cashIn: 10000, description: 'å£°æœ›è¶Šæ¥è¶Šé«˜äº†,é™„è¿‘çš„å•†ä¼šç‰¹é‚€ä½ ä½œä¸ºæœ¬å­£åº¦ä»£è¨€äºº'},
            {value: 15000, cashIn: 15000, description: 'ã€Šä¸‰ç•Œå•†æŠ¥ã€‹ç‰¹åˆ«è®¿è°ˆäº†ä½ çš„è‡´å¯Œä¹‹é“,ä½ çš„ç²¾å½©å‘è¨€æ„ŸæŸ“äº†åœ¨åº§çš„æ‰€æœ‰äºº'},
            {value: 20000, cashIn: 20000, description: 'å®¶ä¸šè¶Šæ¥è¶Šå¤§,åœ¨è¡—å¤´ç°èº«éƒ½ä¼šçº·çº·å¼•æ¥ä¼ é—»"è¿™å®¶åº—è¢«ä»–å…‰é¡¾äº†,ä¸€å®šæ˜¯ä¸ªå€¼å¾—æŠ•èµ„çš„ä¼˜è´¨èµ„äº§"'},
            {value: 25000, cashIn: 30000, description: 'å•†ä¸šå¸å›½åˆå…·è§„æ¨¡,å„è·¯å•†è´¾è¶‹ä¹‹è‹¥é¹œ,äº‰ç›¸åˆä½œ,å¸Œæœ›èƒ½åˆ†å¾—ä¸€æ¯ç¾¹'},
            {value: 30000, cashIn: 35000, description: 'å•†æµ·æ™ºè€…,ä¸ºå•†åœºæ–°äººä¼ é“æˆä¸š,è¨€è¯­é—´ç ç‘ç’€ç’¨,åšå¾—æ»¡å ‚å–å½©'},
            {value: 35000, cashIn: 40000, description: 'ä¸‰ç•Œå•†åœ£,äº§ä¸šéå¸ƒ,å•†ç•Œä¼ å¥‡,åç”Ÿæ¥·æ¨¡'},
            {value: 40000, cashIn: 45000, description: 'å•†ä¸šç‰ˆå›¾ä¸æ–­æ‰©å¼ ,å„åœ°ç«ç›¸é‚€çº¦æŠ•èµ„,è´¢å¯Œå¦‚æ¶“æ¶“ç»†æµæ±‡æˆæ±Ÿæ²³'},
            {value: 45000, cashIn: 50000, description: 'ä¸‰ç•Œé¦–å±ˆä¸€æŒ‡å•†ä¸šå·¨å¤´,å•†ä¸šå¸å›½å·ç„¶è€¸ç«‹,æ— äººä¸æ™“'},
            {value: 50000, cashIn: 60000, description: 'ä»é’ˆå¤´åˆ°é£æœº,ä»æ—¥ç”¨åˆ°å¥¢ä¾ˆ,å•†ä¸šè§¦è§’æ— æ‰€ä¸åŠ,å›ä¸´å•†ç•Œä¹‹å·…'},
            {value: 100000, cashIn: 100000, description: 'å•†ä¸šç‰ˆå›¾çªç ´ä¸‰ç•Œ,è·¨ç•Œå¼€ç–†æ‹“åœŸ,å¼€åˆ›å…¨æ–°å•†ä¸šæ—¶ä»£'},
            {value: 200000, cashIn: 200000, description: 'è´¢å¯Œç§¯ç´¯åˆ°äº†æ–°çš„é«˜åº¦,è£ç™»ä¸‰ç•Œé¦–å¯Œå®åº§,ä¸€ä¸¾ä¸€åŠ¨çš†æ˜¯ç„¦ç‚¹'},
            {value: 300000, cashIn: 300000, description: 'å•†ä¸šå¸å›½ç›–ä¸–æ— åŒ,å•†ç•Œä¼ å¥‡åå‚é’å²,æ•…äº‹è¢«ç¼–å…¥æ•™ç§‘ä¹¦å¹¿ä¸ºæµä¼ '},
            {value: 400000, cashIn: 400000, description: 'å•†ä¸šç‰ˆå›¾éå¸ƒå·²çŸ¥æœªçŸ¥,è§¦è§’å»¶ä¼¸è‡³æ¯ä¸€ä¸ªè§’è½,è´¢å¯Œä¹‹å¤šéš¾ä»¥ä¼°é‡'},
            {value: 500000, cashIn: 500000, description: 'å•†ä¸šå¸å›½è¾¾åˆ°å‰æ‰€æœªæœ‰çš„é«˜åº¦,å•†ç•Œç¥è¯é™ä¸–,ä¸‡äººæ™¯ä»°è†œæ‹œ'},
            {value: 600000, cashIn: 600000, description: 'è´¢å¯Œè¶…è¶Šæƒ³è±¡,å‚²è§†ç¾¤é›„,æˆä¸ºä¼ å¥‡ä¸­çš„ä¼ å¥‡,æ•…äº‹å£å£ç›¸ä¼ '},
            {value: 700000, cashIn: 700000, description: 'å•†ä¸šç–†åŸŸè¦†ç›–æ‰€æœ‰å·²çŸ¥é¢†åŸŸ,è´¢å¯Œç§¯ç´¯åˆ°ä»¤äººéš¾ä»¥ç½®ä¿¡çš„åœ°æ­¥'},
            {value: 800000, cashIn: 800000, description: 'å•†ä¸šå¸å›½åŒ–ä¸ºä¼ è¯´,åå­—æˆä¸ºå•†ä¸šçš„ä»£åè¯,å¦‡å­ºçš†çŸ¥'},
            {value: 1000000, cashIn: 1000000, description: 'è´¢å¯Œç§¯ç´¯åˆ°æ— äººä¼åŠçš„é«˜åº¦,è¶…å‡¡è„±ä¿—,ä¼ è¯´ä¸­çš„å­˜åœ¨,æ•…äº‹æµèŠ³ç™¾ä¸–'}
        ];
        const hasOwnedStock = stockList.filter(s => s.quantity > 0);
        
        let dividend = 0;
        hasOwnedStock.forEach(stock => {
            dividend += Math.floor(stock.basePrice * stock.quantity * 0.05);
        });
        console.log(`å½“å‰è‚¡æ¯åˆ†çº¢ä¸º${dividend}`);
        scalpingState.currentCash += dividend;
        
        
        // æŸ¥æ‰¾å£°æœ›å¯¹åº”çš„äº‹ä»¶ï¼Œå‘ä¸‹åŒ¹é…æœ€æ¥è¿‘çš„äº‹ä»¶
        let selectedEvent = null;
        for (let i = repEvents.length - 1; i >= 0; i--) {
            if (reputation >= repEvents[i].value) {
                selectedEvent = repEvents[i];
                break;
            }
        }
        
        // å¦‚æœæ‰¾åˆ°äº†åˆé€‚çš„äº‹ä»¶ï¼Œå¢åŠ ç°é‡‘å¹¶æ˜¾ç¤ºäº‹ä»¶
        if (!selectedEvent) {
            if (!currentInfoBox) {
                showMerchant(`æœ¬å­£åº¦ä½ æŒ‰éƒ¨å°±ç­åœ°ç»è¥ï¼Œè¾ƒä¸ºä½è°ƒ${hasOwnedStock.length !== 0 ? `ï¼Œä½ æŒæœ‰çš„${hasOwnedStock.length}æ”¯è‚¡ç¥¨å…±è®¡è‚¡æ¯åˆ†çº¢${dividend}å…ƒã€‚` : 'ã€‚'}`);
            } else {
                setTimeout(() => {
                    showMerchant(`æœ¬å­£åº¦ä½ æŒ‰éƒ¨å°±ç­åœ°ç»è¥ï¼Œè¾ƒä¸ºä½è°ƒ${hasOwnedStock.length !== 0 ? `ï¼Œä½ æŒæœ‰çš„${hasOwnedStock.length}æ”¯è‚¡ç¥¨å…±è®¡è‚¡æ¯åˆ†çº¢${dividend}å…ƒã€‚` : 'ã€‚'}`);
                }, 1000);
            } 
        } else {
            if (!currentInfoBox) {
                scalpingState.currentCash += selectedEvent.cashIn;
                showMerchant(`æœ¬å­£åº¦å›é¡¾ï¼š${selectedEvent.description}ï¼Œå£°æœ›å¥–åŠ±é‡‘${Math.min(selectedEvent.cashIn * 3, selectedEvent.cashIn + reputation)}å…ƒ${hasOwnedStock.length !== 0 ? `,ä½ æŒæœ‰çš„${hasOwnedStock.length}æ”¯è‚¡ç¥¨å…±è®¡è‚¡æ¯åˆ†çº¢${dividend}å…ƒã€‚` : 'ã€‚'}`);
            } else {
                setTimeout(() => {
                    scalpingState.currentCash += selectedEvent.cashIn;
                    showMerchant(`æœ¬å­£åº¦å›é¡¾ï¼š${selectedEvent.description}ï¼Œå£°æœ›å¥–åŠ±é‡‘${Math.min(selectedEvent.cashIn * 3, selectedEvent.cashIn + reputation)}å…ƒ${hasOwnedStock.length !== 0 ? `,ä½ æŒæœ‰çš„${hasOwnedStock.length}æ”¯è‚¡ç¥¨å…±è®¡è‚¡æ¯åˆ†çº¢${dividend}å…ƒã€‚` : 'ã€‚'}`);
                }, 1000);
            }
        } 
        updateScalpingPanel();
    }
    
    function processSaleWeek(weekIncrement, energyCostRatio, cashCostRatio) {
        const refreshButton = document.getElementById('enter-next-week');
        const maxWeek = scalpingState.maxSellingWeek;
        const currentWeek = scalpingState.currentSellingWeek;
    
        // è®¡ç®—èŠ±è´¹
        const refreshCost = Math.max(0, Math.floor(scalpingState.maxWarehouseCapacity * 10 * cashCostRatio));
        const energyCost = Math.floor((Math.random() * 3 + 1) * energyCostRatio);
    
        const jiazuxintuo = scalpingState.gadgets.find(gadget => gadget === 'å®¶æ—ä¿¡æ‰˜');
        const timeMachine = scalpingState.gadgets.find(gadget => gadget === 'ç™¾è¾¾ç¿¡ä¸½');
    
        if (scalpingState.currentSellingWeek === 0 && scalpingState.currentCash === 0) {
            showMerchant(`å¼€ä¸šç¬¬ä¸€å¤©ï¼Œæ²¡æœ‰ä¸€ç‚¹å¯åŠ¨èµ„é‡‘å¯ä¸è¡Œï¼Œç›®å‰æœ€å°çš„ä»“åº“æ¯å‘¨ç§Ÿé‡‘${refreshCost}å…ƒï¼Œè¯·ç¡®è®¤ä½ çš„è´¦æˆ·èµ„é‡‘å……è¶³`);
            return;
        }
        
        // æ£€æŸ¥èµ„é‡‘æ˜¯å¦è¶³å¤Ÿ
        if (scalpingState.currentCash < refreshCost) {
            showMerchant(`æœ¬å‘¨åº—ç§Ÿä¸º${refreshCost}å…ƒï¼Œä½ çš„ç°é‡‘ä¸è¶³ä»¥æ”¯ä»˜ï¼`);
            return;
        }
    
        // æ‰£é™¤å‘¨æ•°
        if (scalpingState.currentSellingWeek + weekIncrement <= maxWeek) {
            if (timeMachine && Math.random() < 0.15) {
                const existingContainer = document.getElementById('baida-feili');
                if (existingContainer) document.getElementById('scalping-container').removeChild(existingContainer);
                
                const textContainer = document.createElement('p');
                textContainer.id = 'baida-feili';
                textContainer.style = 'display: flex;color: white;cursor:pointer;z-index: 1000;padding: 20px;gap: 10px;background-color: rgba(0, 0, 0, 0.8);border-radius: 2px;top: 50%;left: 50%;transform: translate(-50%, -50%);position: fixed;align-items: center;flex-direction: column-reverse;justify-content: center;font-style: italic;text-align: center;font-size: 14px;';
                textContainer.innerText = 'ç™¾è¾¾ç¿¡ä¸½æ‹¥æœ‰å°†æ—¶ç©ºå‡æ»çš„åŠŸèƒ½ï¼Œåœ¨æ­¤æ¬¡åˆ·æ–°ä¸­ï¼Œæ—¶é—´æ²¡æœ‰å¢é•¿';
                textContainer.addEventListener('click', () => {
                    textContainer.style.display = 'none';
                })
    
                const imgElement = document.createElement('img');
                imgElement.src = 'https://pic.imgdb.cn/item/66ed55f0f21886ccc0145d08.png';
                imgElement.style = 'width: 240px;height: 144px;box-shadow: 0px 0px 2px 0px #fff;'
                textContainer.appendChild(imgElement);
    
                document.getElementById('scalping-container').appendChild(textContainer);
                setTimeout(() => {
                    if (textContainer) {
                        document.getElementById('scalping-container').removeChild(textContainer);
                    }
                },3000);
            } else {
                scalpingState.currentSellingWeek += weekIncrement;
                scalpingState.currentCash = Math.max(0, scalpingState.currentCash - (refreshCost * weekIncrement));
                scalpingState.playerEnergy = Math.max(0, scalpingState.playerEnergy - energyCost);
            }
            
            if (jiazuxintuo) scalpingState.currentCash += Math.floor(Math.random() * 5000 + 5000) * weekIncrement; //åº”ç”¨å®¶æ—ä¿¡æ‰˜
    
            // æ›´æ–°è‚¡ç¥¨æŒæœ‰çŠ¶æ€
            let stockOwned = stockList.filter(s => s.quantity > 0);
            
            stockOwned.forEach(s => {
                s.dealWeek = Math.max(0, s.dealWeek - weekIncrement);
            });
    
            // æ›´æ–° UI å’Œäº‹ä»¶
            updateStockPrice();
            getRandomScalpableItem();
    
            // æ›´æ–°æŒ‰é’®æ–‡å­—
            if (scalpingState.currentSellingWeek === maxWeek) {
                refreshButton.innerText = 'ç»“ç®—æ”¶ç›Š';
            } else {
                refreshButton.innerText = 'åˆ·æ–°ä¸€å‘¨';
            }
    
            // æ‰§è¡Œå£°æœ›äº‹ä»¶æ¯10å‘¨
            if (scalpingState.currentSellingWeek % 10 === 0) {
                getReputationAndShareEvent();
            }
            
            let randomEventRate = 1; //é¢„ç•™æ³•å®ä½ç½®
            if (!currentInfoBox && Math.random() < 0.2) {
                generateRandomEvents();
            }
            
        } else {
            showMerchant('å·²ç»åˆ°è¾¾æœ€å¤§å‘¨æ•°ï¼Œä¸èƒ½ç»§ç»­ã€‚');
        }
        updateScalpingPanel();
    }
    
    function finalizeScalping() {
        const goldGot = sellAssetsAndExchangeCash();
        const initialCost = scalpingState.investmentCount * 50000;
        const netAsset = calculateNetAsset();
    
        const doubleLuck = scalpingState.gadgets.includes('åŒå–œä¸´é—¨');
        let scoreRatio = 1;
        if (doubleLuck) scoreRatio = 2;
    
        const scoreToAdd = Math.min(20000 * scoreRatio, Math.floor(goldGot.totalValue / 10000) * scoreRatio);
    
        // ä¿®æ­£èµ‹å€¼é€»è¾‘ï¼Œç”Ÿæˆæ¢è¡Œçš„ recordMessage
        let recordMessage = '';
        if (scalpingState.achievements.length > 0) {
            recordMessage = generateRecordMessage().join('\n'); // å°†æ•°ç»„æ‹¼æ¥ä¸ºå­—ç¬¦ä¸²
        }
    
        if (highestAsset < netAsset) {
            highestAsset = netAsset;
            updateHighestAssetDisplay(highestAsset);
        }
    
        scalpingScore += scoreToAdd;
        goldAmount += goldGot.totalValue;
        updateGoldDisplay(goldAmount);
    
        showMerchant(`ä½ ç»å†${scalpingState.currentSellingWeek}å‘¨çš„å•†åœºé–æˆ˜ï¼Œåˆ›é€ äº†ä¸ä¿—çš„ç»å•†ä¸šç»©ï¼Œç»è¿‡æ ¸ç®—ï¼š\n\n${recordMessage} \n\næœªå˜ç°çš„èµ„äº§ç¼©æ°´äº†${convertPrice(goldGot.assetShrinkValue)}é‡‘å­ï¼Œå‡€åˆ©æ¶¦ä¸º${convertPrice(Math.max(0, goldGot.totalValue - initialCost))}é‡‘å­ã€‚\n\næ‰€æœ‰èµ„äº§å·²å…‘æ¢ä¸º${convertPrice(goldGot.totalValue)}é‡‘å­ï¼\n\næœ¬æ¬¡ç»å•†ä½ çš„ç§¯åˆ†å¢é•¿äº†${scoreToAdd}ï¼Œå½“å‰æ€»ç§¯åˆ†ä¸º${scalpingScore}ã€‚`);
        resetScalping();
        saveGameState();
    }
    
    // è°ƒæ•´â€œä¿®å…»ä¸¤å‘¨â€çš„äº‹ä»¶ç›‘å¬å™¨
    document.getElementById('relax-byweek').addEventListener('click', () => {
        const heroToken = scalpingState.gadgets.find(gadget => gadget === 'è‹±é›„ä»¤');
        const refreshCostRatio = heroToken ? 0.7 : 1;
    
        if (currentSlider) {
            document.body.removeChild(currentSlider);
            currentSlider = null;
        }
        
        if (scalpingState.maxSellingWeek - scalpingState.currentSellingWeek >= 2) {
            for (let i = 0; i < 2; i++) {
                processSaleWeek(1, 1, refreshCostRatio);// ä¼‘å…»ä¸¤å‘¨
            }
            
            scalpingState.playerEnergy = 100;
            showMerchant('ç¾ç¾ä¼‘æ¯åŠä¸ªæœˆï¼Œä½ çš„çŠ¶æ€é‡å›å·…å³°ï¼');
            updateScalpingPanel();
        } else {
            showMerchant('ä½ åœ¨å¸‚åœºçš„ç§ŸæœŸé©¬ä¸Šå°±è¦åˆ°äº†ï¼Œä¸èƒ½æ‰§è¡Œä¼‘æ¯åŠ¨ä½œäº†å“¦');
        }
    });
    
    // è°ƒæ•´ refreshSaleWeek å‡½æ•°
    function refreshSaleWeek() {
        const fitnessPowder = scalpingState.gadgets.find(gadget => gadget === 'å¼ºèº«æ•£');
        const heroToken = scalpingState.gadgets.find(gadget => gadget === 'è‹±é›„ä»¤');
        const energyCostRatio = fitnessPowder ? 0.7 : 1;
        const refreshCostRatio = heroToken ? 0.7 : 1;
        const selectedItems = scalpingItems.filter(i => i.itemActivate);
    
        if (currentSlider) {
            document.body.removeChild(currentSlider);
            currentSlider = null;
        }
    
        if (selectedItems.length < 6) {
            showMerchant(`ä½ éœ€è¦é€‰æ‹©æ¿€æ´»6ä¸ªå•†å“æ‰èƒ½åœ¨å¸‚åœºè¿›è¡Œè¿ä½œï¼è¿˜éœ€è¦${6 - selectedItems.length}ä¸ªå¾…æ¿€æ´»å•†å“ï¼`);
            generateItemToDisplay();
            return;
        }
            
        if (scalpingState.currentSellingWeek < scalpingState.maxSellingWeek) {
            processSaleWeek(1, energyCostRatio, refreshCostRatio);  // å¸¸è§„æ›´æ–°ä¸€å‘¨
        } else {
            finalizeScalping();  // è¾¾åˆ°æœ€å¤§å‘¨æ•°æ—¶è¿›è¡Œç»“ç®—
        }
    }
    
    function recordAchivements() {
        const netAsset = calculateNetAsset(); // è·å–å½“å‰èµ„äº§
        let achivementsGoal = [
            {description: 'ä½ çš„èµ„äº§ç¬¬ä¸€æ¬¡çªç ´100ä¸‡ï¼Œåˆå°ä¸­äº§çš„æ»‹å‘³', type: 'netAsset', reqValue: '1000000'},
            {description: 'ä½ çš„èµ„äº§çªç ´500ä¸‡ï¼Œâ€œå½©ç¥¨å¤´å¥–äº¦ä¸è¿‡å¦‚æ­¤â€', type: 'netAsset', reqValue: '5000000'},
            {description: 'ä½ åŠ å…¥äº†åƒä¸‡å¯Œç¿ä¿±ä¹éƒ¨', type: 'netAsset', reqValue: '10000000'},
            {description: 'åæ‹¥ç¬¬ä¸€ä¸ªä¸‰åƒä¸‡ï¼Œå°ç›®æ ‡å¾—ä»¥å®ç°å°åŠ', type: 'netAsset', reqValue: '30000000'},
            {description: 'åœ¨1äº¿å°ç›®æ ‡çš„åŠå±±è…°ç¥ç¨å°˜ä¸–', type: 'netAsset', reqValue: '50000000'},
            {description: 'ä½ çš„èµ„äº§ç¬¬ä¸€æ¬¡çªç ´1äº¿ï¼Œå®ç°äººç”Ÿçš„å°ç›®æ ‡', type: 'netAsset', reqValue: '100000000'},
            {description: 'ä½ èµšåˆ°äº†10äº¿ï¼Œå®ç°äº†äººç”Ÿçš„è´¢å¯Œè‡ªç”±ï¼Œå¼€å§‹è¿½æ±‚æ›´é«˜é˜¶çš„ç²¾ç¥è‡ªç”±', type: 'netAsset', reqValue: '1000000000'},
            {description: 'ä½ æŠ•èµ„çš„ç¬¬ä¸€æ”¯è‚¡ç¥¨å¼€å§‹äº§ç”Ÿæ”¶ç›Šï¼Œåˆå°èµ„äº§é…ç½®çš„å¿«æ„Ÿ', type: 'stock', reqValue: '1'},
            {description: 'ä½ è¶…è¶Šäº†è¿‡å»çš„è‡ªå·±ï¼Œè´¢å¯Œç§¯ç´¯è¾¾åˆ°äº†å½“å‰æœ€é«˜è®°å½•', type: 'highestScore', reqValue: '1'},
        ];
    
        const stillGoal = achivementsGoal.filter(goal =>
            !scalpingState.achievements.some(achi => achi.description === goal.description)
        );
    
        stillGoal.forEach(goal => {
            if (goal.type === 'netAsset' && parseInt(goal.reqValue) <= netAsset) {
                const achievedWeek = scalpingState.currentSellingWeek;
                const arrayOfAchievements = {description: goal.description, week: achievedWeek};
                scalpingState.achievements.push(arrayOfAchievements);
            }
    
            if (goal.type === 'stock' && stockList.find(s => s.quantity >= parseInt(goal.reqValue) && s.dealWeek === 0)) {
                const achievedWeek = scalpingState.currentSellingWeek;
                const arrayOfAchievements = {description: goal.description, week: achievedWeek};
                scalpingState.achievements.push(arrayOfAchievements);
            }
    
            if (goal.type === 'highestScore' && highestAsset < netAsset) {
                const achievedWeek = scalpingState.currentSellingWeek;
                const arrayOfAchievements = {description: goal.description, week: achievedWeek};
                scalpingState.achievements.push(arrayOfAchievements);
            }
            
        });
    }
    
    function generateRecordMessage() {
        let recordMessage = [];
        const achievements = scalpingState.achievements;
    
        if (achievements.length > 0) {
            achievements.forEach(achi => {
                const message = `ç¬¬${achi.week}å‘¨æ—¶ï¼Œ${achi.description}`;
                recordMessage.push(message);
            });
        }
    
        return recordMessage;
    }
            
    function generateRandomEvents() {
        const randomEvent = [
            {
                unit: 1, 
                display: 'æ–°æœˆæ‘åˆ˜å¤§çˆ·æƒ³è®©ä½ ææ¬¾50000ï¼Œå…´å»ºä¸€æ‰€æ‘æ°‘å°å­¦ï¼Œæ˜¯å¦æ„¿æ„ï¼Ÿ', 
                cost: 50000, 
                bias: 0.5, 
                goodEvent: 'æ‘æ°‘å°å­¦æˆåŠŸå…´å»ºï¼Œä½ åœ¨æ–°æœˆæ‘å£°åè¿œæ’­ï¼ˆå£°æœ›+3000ï¼‰ï¼Œå—åˆ°æ‘æ”¿åºœè¡¨å½°ï¼Œå¥–åŠ±2ä¸‡', 
                goodReward: 20000, 
                energyReward: 0,
                reputationReward: 3000,
                badEvent: 'ä½ çš„å–„æ¬¾è¢«å¼€å‘å•†æŒªç”¨ï¼Œè±†è…æ¸£å·¥ç¨‹ä¸€é˜µé£å°±å¹å€’äº†ï¼Œä½ ä¸å¾—ä¸å†è¿½åŠ 1ä¸‡å¸®åŠ©ä¿®ç¼®', 
                badPenalty: 10000,
                energyPenalty: 0,
                reputationPenalty: 0,
                img: 'https://pic.imgdb.cn/item/66eadcbdf21886ccc0e7f793.png'
            }, //åˆ˜å¤§ä¼¯æå°å­¦
            {
                unit: 2, 
                display: 'å¬è¯´é»‘è‰²æ°´åŸŸçš„å¤§é—¸èŸ¹å¾ˆæœ‰å…»æ®–å‰æ™¯ï¼Œå®‹æŸé‚€è¯·ä½ æŠ•èµ„å…¥è‚¡10ä¸‡å…ƒï¼Œæ˜¯å¦åº”é‚€ï¼Ÿ', 
                cost: 100000, 
                bias: 0.5, 
                goodEvent: 'ä½œä¸ºå¤©ä¹¦ç¬¬ä¸€æ‰¹å…»èƒèŸ¹çš„äººï¼Œä½ ç¡®å®æåˆ°äº†ç¬¬ä¸€æ¡¶é‡‘ï¼Œè¿æœ¬å¸¦åˆ©è·å¾—30ä¸‡ç°é‡‘æ”¶å…¥', 
                goodReward: 300000, 
                energyReward: 0,
                reputationReward: 0,
                badEvent: 'é»‘è‰²æ°´åŸŸè¢«æ¯’è›‡å…¥ä¾µï¼Œè™½ç„¶èƒèŸ¹å®‰ç„¶æ— æ™ï¼Œä½†æ˜¯æ— äººæ•¢å»æ•æï¼Œé”™è¿‡æœ€ä½³æ•èŸ¹å­£èŠ‚ï¼ŒæŸå¤±3ä¸‡', 
                badPenalty: 30000,
                energyPenalty: 0,
                reputationPenalty: 0,
                img: 'https://pic.imgdb.cn/item/66eadcbdf21886ccc0e7f787.png'
            }, //å®‹æŸå…»èƒèŸ¹
            {
                unit: 3, 
                display: 'é»„ä¸€å‡¡å‘æ¥æŒ‘æˆ˜ä¹¦ï¼Œâ€œè¿‘æ¥æ–°å­¦äº†å‡ æ‹›åˆ€æ³•ï¼Œé‚€è¯·æ¥ä¸æˆ‘ä¸€æˆ˜ï¼â€ï¼Œæ˜¯å¦åº”æˆ˜ï¼Ÿ', 
                cost: 0, 
                bias: 0.5, 
                goodEvent: 'ç—›å¿«çš„æ‰“å®Œä¸€æ¶ï¼Œåè€Œç²¾åŠ›å……æ²›äº†èµ·æ¥ï¼ˆ+20ï¼‰', 
                goodReward: 0, 
                energyReward: 20,
                reputationReward: 0,
                badEvent: 'é•¿ä¹…ä¼æ¡ˆä¸æ›¾æ´»åŠ¨ï¼Œä¸æ…åœ¨åˆ‡ç£‹ä¸­ä¼¤äº†ç­‹éª¨ï¼Œç²¾åŠ›å¤§å‡ï¼ˆ-20ï¼‰', 
                badPenalty: 0,
                energyPenalty: 20,
                reputationPenalty: 0,
                img: 'https://pic.imgdb.cn/item/66eadcbdf21886ccc0e7f762.png'
            }, //é»„ä¸€å‡¡æ‰“æ¶
            {
                unit: 4, 
                display: 'ä¸Šå®˜çº¢æ–°ç ”åˆ¶äº†ä¸€ç§å¯ä½¿å® ç‰©å˜è‰²çš„æ— æ¯’æŸ“å‰‚ï¼Œå¥¹å¼‚å¸¸å…´å¥‹åœ°æƒ³è¦ä½ ç»™å¥¹æŠ•èµ„20ä¸‡å…ƒï¼Œæ‰¿è¯ºä¼šç»™ä½ è¶…å€¼çš„åˆ†çº¢æ¯”ä¾‹', 
                cost: 200000, 
                bias: 0.4, 
                goodEvent: 'é»‘ç§‘æŠ€æŸ“æ–™ä¸€ç»æ¨å‡ºå¸‚åœºï¼Œé¡·åˆ»é—´é£é¡å„å¤§å…»å® å®¶åº­ï¼Œçº·çº·ç»™è‡ªå·±çš„çˆ±å® æŸ“ä¸Šäº†äº”å…‰åè‰²ã€‚ä½ åœ¨æ­¤æ¬¡æŠ•èµ„ä¸­è·å¾—50ä¸‡çš„åˆ†çº¢æ”¶ç›Š', 
                goodReward: 500000, 
                energyReward: 0,
                reputationReward: 0,
                badEvent: 'ç”±äºæœªçŸ¥æ·»åŠ ç‰©ï¼ŒæŸ“æ–™æœªè¿‡æœäº‘è´¨ç›‘å±€ï¼ŒæŠ•èµ„ä»˜è¯¸ä¸œæµï¼Œç™½è´¹10ç‚¹ç²¾åŠ›', 
                badPenalty: 0,
                energyPenalty: 10,
                reputationPenalty: 0,
                img: 'https://pic.imgdb.cn/item/66eadcbdf21886ccc0e7f770.png'
            }, //ä¸Šå®˜çº¢æ‹‰æŠ•èµ„
            {
                unit: 5, 
                display: 'é“¶æœˆå•†ä¼šå°†è¦ä¸¾åŠå››å¹´ä¸€å±Šçš„ä¸‰å›½è´¸æ˜“è®ºå›ï¼Œé‚€è¯·ä½ èµåŠ©20ä¸‡å…ƒæˆä¸ºç‰¹çº¦èµåŠ©å•†', 
                cost: 200000, 
                bias: 0.7, 
                goodEvent: 'é“¶æœˆå•†ä¼šæ˜¯ä¸‰ç•Œæœ€çŸ¥åçš„è´¸æ˜“åå®šç»„ç»‡ï¼Œåœ¨æ­¤æ¬¡å¤§ä¼šä¸­ï¼Œä½ çš„å¤§åè¢«èµ«ç„¶æ”¾åœ¨ç‰¹åˆ«èµåŠ©å•†åå•ä¸­ï¼Œä¸å°‘å¤§å•†äººè§æ­¤çº·çº·ä¸ä½ ç£‹å•†ç»è´¸ä¹‹äº‹(-10ç²¾åŠ›)ï¼Œä½ çš„å£°æœ›æé«˜10000ç‚¹', 
                goodReward: 0, 
                energyReward: -10,
                reputationReward: 10000,
                badEvent: 'èµåŠ©å•†å¤ªå¤šï¼Œæ— äººåœ¨æ„ï¼Œç™½è´¹10ç‚¹ç²¾åŠ›', 
                badPenalty: 0,
                energyPenalty: 10,
                reputationPenalty: 0,
                img: 'https://pic.imgdb.cn/item/66eadcbdf21886ccc0e7f753.png'
            }, //é“¶æœˆå•†ä¼šæ‹‰èµåŠ©
            {
                unit: 6, 
                display: 'ä¸ç•™æ‰‹é¬¼é¬¼ç¥Ÿç¥Ÿåœ°è·Ÿä½ è¯´è¦å»çš‡å®«ç›—å®ï¼Œæƒ³æ‰¾ä½ å€Ÿ1ä¸‡ç°é‡‘æ‰“ç‚¹ç¦å«', 
                cost: 10000, 
                bias: 0.3, 
                goodEvent: 'ä¸ç•™æ‰‹ä¸æ„§æ˜¯æ±Ÿæ´‹å¤§ç›—ï¼Œè¿å§œå¤ªåçš„è´´èº«å®ç‰éƒ½èƒ½ç›—å¾—ï¼Œæ‰¾äº†å®¶ä¸æ€•æ­»çš„å½“é“ºå…¸å½“ä¹‹åï¼Œåˆ†å¾—ä½ 30ä¸‡å…ƒ', 
                goodReward: 300000, 
                energyReward: 0,
                reputationReward: 0,
                badEvent: 'è´¿èµ‚å¤±è´¥ï¼Œä¸ç•™æ‰‹åœ¨å®¡é—®ä¸­ä¾›å‡ºäº†ä½ çš„åå­—ï¼Œä¸ä»…ç½šæ¬¾æƒ¨é‡ï¼ˆ-20ä¸‡ï¼‰è¿˜ä»¤ä½ å£°æœ›å¤§å‡ï¼ˆ-10000ï¼‰', 
                badPenalty: 200000,
                energyPenalty: 0,
                reputationPenalty: 10000,
                img: 'https://pic.imgdb.cn/item/66eadcbdf21886ccc0e7f77b.png'
            }, //ä¸ç•™æ‰‹ç›—å®
        ];
        
        // ä¿®æ­£éšæœºé€‰æ‹©é€»è¾‘
        const selectedRandomEvent = randomEvent[Math.floor(Math.random() * randomEvent.length)];
        const eventMessage = selectedRandomEvent.display;
        const imgUrl = selectedRandomEvent.img;
    
        // ç¡®è®¤æŒ‰é’®çš„å¤„ç†å‡½æ•°
        const confirmAction = () => {
            // æ‰£é™¤äº‹ä»¶è´¹ç”¨
            if (scalpingState.currentCash < selectedRandomEvent.cost) {
                showMerchant('ä½ çš„ç°é‡‘ä¸è¶³ï¼');
                return;
            }
            
            scalpingState.currentCash = Math.max(0, scalpingState.currentCash - selectedRandomEvent.cost);
            
            const playerReputation = calculatePlayerReputation();
            const repBonus = playerReputation * 0.000001; //å®šä¹‰å£°æœ›çš„æ­£å‘å½±å“
            let extraBias = repBonus; //æ­¤å¤„é¢„ç•™æ³•å®çš„ä½œç”¨
            
            // æ ¹æ® bias ç¡®å®šæ˜¯å¥½äº‹ä»¶è¿˜æ˜¯åäº‹ä»¶
            if (Math.random() < Math.min(0.8, selectedRandomEvent.bias + extraBias)) {
                // å¥½äº‹ä»¶ï¼šç»™äºˆå¥–åŠ±
                scalpingState.currentCash += selectedRandomEvent.goodReward;
                scalpingState.playerEnergy = Math.min(100, scalpingState.playerEnergy + selectedRandomEvent.energyReward);
                
                if (selectedRandomEvent.reputationReward) scalpingState.playerReputation += selectedRandomEvent.reputationReward;
                
                showMerchant(selectedRandomEvent.goodEvent);
            } else {
                // åäº‹ä»¶ï¼šç»™äºˆæƒ©ç½š
                scalpingState.currentCash = Math.max(0, scalpingState.currentCash - selectedRandomEvent.badPenalty);
                scalpingState.playerEnergy = Math.max(0, scalpingState.playerEnergy - selectedRandomEvent.energyPenalty);
                
                if (selectedRandomEvent.reputationPenalty) scalpingState.playerReputation -= selectedRandomEvent.reputationPenalty;
                
                showMerchant(selectedRandomEvent.badEvent);
            }
            // æ›´æ–°é¢æ¿
            updateScalpingPanel();
        };
    
        // æ˜¾ç¤ºäº‹ä»¶ä¿¡æ¯ï¼Œå¹¶ä¼ é€’ç¡®è®¤æ“ä½œ
        showInfoBox(eventMessage, confirmAction, null, null, imgUrl, '88px * 88px');
    }     
    
    function updateHighestAssetDisplay(highestAsset, display = true) {
        const scalpingDisplayElement = document.getElementById('scalping-display');
        const commentsByAsset = [
            {value: 100000, comments: 'è™½ä¸è‡³äºè…°ç¼ ä¸‡è´¯ï¼Œä½†ä¹Ÿæœ‰ä¸€å¥—ç‹¬å±äºä½ çš„ç»å•†ä¹‹é“'},
            {value: 500000, comments: 'ç»å•†æœ‰é“ï¼Œè´¢å¯Œæ¸é•¿ï¼Œä½ çš„äº‹ä¸šæ­£åœ¨è’¸è’¸æ—¥ä¸Š'},
            {value: 1000000, comments: 'ç™½æ‰‹èµ·å®¶ï¼Œç§¯ç´¯äº†ä¸€å®šçš„è´¢å¯Œï¼Œä½ å·²æˆä¸ºå•†ç•Œçš„æ–°ç§€'},
            {value: 3000000, comments: 'å•†æµ·æ²‰æµ®å¤šå¹´ï¼Œä½ å·²æ˜¯å•†ç•Œçš„ä¸­æµç ¥æŸ±ï¼Œè´¢å¯Œç§¯ç´¯é¢‡ä¸°'},
            {value: 8000000, comments: 'è´¢å¯Œç§¯ç´¯å·²è¾¾åˆ°ä¸€ä¸ªæ–°çš„é«˜åº¦ï¼Œä½ çš„å•†ä¸šå¸å›½æ­£åœ¨å´›èµ·'},
            {value: 10000000, comments: 'å•†ä¸šå¸å›½åˆå…·è§„æ¨¡ï¼Œä½ çš„è´¢å¯Œå·²ç»è¶…è¿‡äº†å¤§å¤šæ•°äººä¸€ç”Ÿçš„ç§¯ç´¯'},
            {value: 20000000, comments: 'è´¢å¯Œå¦‚å±±ï¼Œå•†ä¸šç‰ˆå›¾éå¸ƒå„åœ°ï¼Œä½ å·²æˆä¸ºå•†ç•Œçš„ç¿˜æ¥š'},
            {value: 50000000, comments: 'å¯Œå¯æ•Œå›½ï¼Œå•†ä¸šå¸å›½ç›–ä¸–æ— åŒï¼Œä½ æ˜¯å½“ä¹‹æ— æ„§çš„å•†ä¸šå·¨å¤´'},
            {value: 100000000, comments: 'ä½ çš„è´¢å¯Œå·²ç»è¾¾åˆ°äº†å¸¸äººéš¾ä»¥æƒ³è±¡çš„åœ°æ­¥ï¼Œä¼ å¥‡çš„å•†ä¸šäººç”Ÿè°±å†™ç€æ–°çš„ç¯‡ç« '},
            {value: 500000000, comments: 'ç«™åœ¨è´¢å¯Œä¹‹å·…ï¼Œä¿¯ç°å•†ç•Œï¼Œä½ å·²æˆä¸ºè¿™ä¸ªæ—¶ä»£çš„å•†ä¸šä¼ å¥‡'},
            {value: 1000000000, comments: 'ä½ åœ¨ä¸€å¹´ä¹‹å†…ç§¯ç´¯äº†å¯Œå¯æ•Œå›½çš„è´¢å¯Œï¼Œç´¢ç½—æ–¯æåˆ°ä½ æ—¶éƒ½ä¼šéª„å‚²åœ°æŒºèƒ¸å‘Šè¯‰åˆ«äººï¼šä»–å°±æ˜¯æˆ‘çš„é‡‘èæ©å¸ˆï¼'}
        ];
    
        // æ£€æŸ¥æ˜¯å¦å·²ç»å­˜åœ¨ recordOverlayï¼Œé¿å…é‡å¤æ·»åŠ 
        let selectedComment = null;
        for (let i = commentsByAsset.length - 1; i >= 0; i--) {
            if (highestAsset >= commentsByAsset[i].value) {
                selectedComment = commentsByAsset[i].comments;
                break;
            }
        }
    
        if (!display) return selectedComment;
        highestAsset = highestAsset.toLocaleString('en-US');
        
        const existingContainer = document.getElementById('scalping-record-overlay-container');
        if (existingContainer) {
            scalpingDisplayElement.removeChild(existingContainer);
        }
    
        const overlayContainer = document.createElement('div');
        overlayContainer.id = 'scalping-record-overlay-container';
        overlayContainer.style = 'position: fixed;top: 50%; left: 50%; transform: translate(-50% , -50%);width:100%;height:100%;';
        overlayContainer.addEventListener('click', () => {
            scalpingDisplayElement.removeChild(overlayContainer);
        })
        
        // åˆ›å»ºæ–°çš„è¦†ç›–å±‚
        const recordOverlay = document.createElement('div');
        recordOverlay.id = 'scalping-record-overlay';  // ç»™å®šå”¯ä¸€çš„ IDï¼Œæ–¹ä¾¿ç®¡ç†
        recordOverlay.style.zIndex = '9999';
        recordOverlay.style.display = 'flex';
        recordOverlay.style.position = 'relative';
        recordOverlay.style.backgroundImage = 'url(https://pic.imgdb.cn/item/66e71037d9c307b7e9202eb7.png)';
        recordOverlay.style.backgroundSize = 'contain';
        recordOverlay.style.backgroundRepeat = 'no-repeat';
        recordOverlay.style.backgroundPosition = 'center';
        recordOverlay.style.width = '100%';
        recordOverlay.style.height = '100%';
        recordOverlay.style.flexDirection = 'column';
        recordOverlay.style.alignItems = 'center';
        recordOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.4)';
        recordOverlay.style.color = 'white';
        recordOverlay.style.fontSize = '24px';
        recordOverlay.style.fontWeight = 'bold';
        recordOverlay.style.justifyContent = 'center';  // æ·»åŠ å±…ä¸­å¯¹é½
    
        const recordText = document.createElement('div');
        recordText.id = 'scalping-record-text';
        recordText.style = 'position: absolute;top: 50%; left: 50%; transform: translate(-50% , -50%); color: crimson; font-size: 24px; font-weight: bold; text-align: center;max-width:200px;';
        if (selectedComment) {
            recordText.innerText = `åˆ›é€ æ–°çš„å†å²è®°å½•ï¼š${highestAsset}å…ƒï¼${selectedComment}ï¼`;
        } else {
            recordText.innerText = `åˆ›é€ æ–°çš„å†å²è®°å½•ï¼š${highestAsset}å…ƒï¼ä½ çš„ç»å•†å¤´è„‘æ— äººèƒ½æ•Œï¼`;
        }
        
        recordOverlay.appendChild(recordText);
        overlayContainer.appendChild(recordOverlay);
        scalpingDisplayElement.appendChild(overlayContainer);
        
    
        // è®¾ç½® 20 ç§’åç§»é™¤è¦†ç›–å±‚
        setTimeout(() => {
            if (existingContainer) {
                scalpingDisplayElement.removeChild(existingContainer);
            }
        }, 20000);
    
    }
            
    function resetScalping() {
        const marketPanel = document.getElementById('scalping-item-info');
        const warehousePanel = document.getElementById('warehouse-item-info');
        const relaxButton = document.getElementById('relax-byweek');
        marketPanel.innerHTML = ''; // æ¸…ç©ºç°æœ‰å†…å®¹
        warehousePanel.innerHTML = ''; // æ¸…ç©ºç°æœ‰ä»“åº“å†…å®¹
        
        if (relaxButton.style.display !== 'none') {
            relaxButton.style.display = 'none';
        }
        
        scalpingState = {
            currentSellingWeek: 0,
            maxSellingWeek: 52,
            playerReputation: 0,
            playerEnergy: 100,
            currentCash: 0, // ç¤ºä¾‹åˆå§‹ç°é‡‘
            netAsset: 0, 
            usedWarehouseCapacity: 0,
            maxWarehouseCapacity: 100, // åˆå§‹ä»“åº“å®¹é‡
            warehouseUpdateCount: 0,
            investmentCount: 0,
            holdItems: {}, // å­˜æ”¾ç©å®¶è´­ä¹°çš„å•†å“
            gadgets: [],
            achievements: []
        };
    
        if (isStock) openStockPanel();
        keyPhaseCount = 0;
        resetStockState();
        updateStockPanelDisplay();
        updateScalpingPanel();
        document.getElementById('enter-next-week').innerText = 'åˆ·æ–°ä¸€å‘¨';
        document.getElementById('applied-scalping-gadgets').innerHTML = '';
    }
    
    function sellAssetsAndExchangeCash() {
        const netAssets = calculateNetAsset();
        const cash = scalpingState.currentCash;
        const treasureWood = scalpingState.gadgets.find(gadget => gadget === 'çå®æ¡ˆ');
        
        let propertyRatio = 1;
    
        // å¦‚æœæœ‰"çå®æ¡ˆ"ï¼Œæå‡èµ„äº§ä»·å€¼
        if (treasureWood) {
            propertyRatio = 1.2;
        }
    
        // ç°é‡‘éƒ¨åˆ†
        let cashChangeNum = cash;
    
        // è®¡ç®—åŸå§‹æœªå˜ç°èµ„äº§çš„æ€»ä»·å€¼
        let originalAssetValue = netAssets - cash;
    
        // è®¡ç®—èµ„äº§æ³¢åŠ¨ç³»æ•°
        let assetValue = Math.floor(originalAssetValue * (Math.min(1, Math.random() * 0.2 + 0.6) * propertyRatio));
    
        // è®¡ç®—ç¼©æ°´å€¼
        let shrinkValue = originalAssetValue - assetValue;
        let assetShrinkValue = Math.max(0, shrinkValue); // ç¡®ä¿ç¼©æ°´å€¼ä¸ä¸ºè´Ÿæ•°
    
        // æ€»ä»·å€¼ = ç°é‡‘ + å˜åŠ¨åèµ„äº§çš„ä»·å€¼
        let totalValue = Math.max(0, cashChangeNum + assetValue);
    
        return { totalValue, assetShrinkValue }; // è¿”å›æ€»ä»·å€¼å’Œç¼©æ°´å€¼
    }
            
    function quitScalping() {
        if (scalpingState.currentSellingWeek < scalpingState.maxSellingWeek) {
            showInfoBox('æå‰é€€å¸‚å¯ä»¥ç«‹å³ç»“ç®—ä½ çš„æ€»èµ„äº§ï¼Œä½†æ˜¯ä¼šå¸¦æ¥20%çš„æŠ˜æŸä¸”ä¸ä¼šè·å¾—ç»å•†ç§¯åˆ†ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ',
                       () => {
                            const cash = sellAssetsAndExchangeCash();
                            const goldGot = Math.floor(cash.totalValue * 0.8);
                            goldAmount += goldGot;
                            updateGoldDisplay(goldAmount);
                            showMerchant(`æ‰€æœ‰å•†å“å·²ç»ç»“ç®—å®Œæ¯•ï¼Œä½ æ€»è®¡å–å‡ºäº†${convertPrice(goldGot)}é‡‘å­ï¼`);
                            resetScalping();
                       },
                       () => showMerchant('å–æ¶ˆäº¤æ˜“ï¼'),
                       'red','https://pic.imgdb.cn/item/66e32523d9c307b7e995cf28.png','88px * 88px');
        } else {
            refreshSaleWeek();
        }
    }
            
    let currentSlider = null;
            
    // é€šç”¨è¿›åº¦æ¡åˆ›å»ºå’Œå¤„ç†å‡½æ•°
    function handleItemTransaction(item, itemInfo, actionType) {
        // åˆ¤æ–­è¡Œä¸ºç±»å‹ï¼šè´­ä¹°æˆ–å‡ºå”®
        const isPurchase = actionType === 'purchase';
    
        if (currentSlider) {
            document.body.removeChild(currentSlider);
            currentSlider = null;
        }
    
        // è·å–æˆ–åˆ›å»ºè¿›åº¦æ¡
        let sliderContainer = document.getElementById(`${actionType}-slider-container`);
        if (!sliderContainer) {
            sliderContainer = document.createElement('div');
            sliderContainer.id = `${actionType}-slider-container`;
            sliderContainer.style = 'display: flex;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);width: 80%;max-height: 80%;min-height: 10%;z-index: 9999;font-size: 14px;padding: 10px 20px 5px;background-color: rgb(223, 191, 110);color: rgb(146, 52, 28);background-image: url(https://pic.imgdb.cn/item/663885620ea9cb14033e4f6e.png);background-repeat: repeat;background-size: auto;box-shadow: rgb(30, 46, 47) 0px 0px 0px 1px, rgb(111, 57, 28) 0px 0px 0px 1px inset;border: 1px solid rgb(235, 172, 59);overflow-y: auto;flex-direction: column;align-items: center;gap: 5px;';
    
            const sliderLabel = document.createElement('label');
            sliderLabel.innerText = `æ‹–åŠ¨${isPurchase ? 'è´­ä¹°' : 'å‡ºå”®'}æ•°é‡ï¼š`;
            sliderContainer.appendChild(sliderLabel);
    
            const slider = document.createElement('input');
            slider.id = `${actionType}-slider`;
            slider.type = 'range';
            slider.min = 0;
            slider.max = 100;
            slider.value = 0;
            slider.style = 'width: 90%;appearance: none;border-radius: 20px;border: 1px groove #0475ff;box-shadow: inset 0px 0px 2px 1px #0475ff;';
            sliderContainer.appendChild(slider);
    
            const quantityLabel = document.createElement('div');
            quantityLabel.id = `${actionType}-quantity`;
            quantityLabel.innerText = `${isPurchase ? 'è´­ä¹°' : 'å‡ºå”®'}æ•°é‡: 0, é¢„è®¡é‡‘é¢: 0`;
            sliderContainer.appendChild(quantityLabel);
    
            const itemDescription = document.createElement('div');
            itemDescription.id = `${actionType}-quantity`;
            itemDescription.innerText = `å•†å“è¯´æ˜: ${item.description}`;
            sliderContainer.appendChild(itemDescription);
    
            const confirmButton = document.createElement('button');
            confirmButton.id = `confirm-${actionType}-button`;
            confirmButton.style = 'border: 1px solid #6F391C;background: linear-gradient(to bottom, #E47F47, #CE6633, #963D1C);box-shadow: inset 0px 0px 2px 1px #87431F;font-size: 14px;border-radius: 5px;color: #F9DE9B;padding: 4px 6px;cursor: pointer;transition: transform 0.1s, box-shadow 0.1s;';
            confirmButton.innerText = `ç¡®è®¤${isPurchase ? 'è´­ä¹°' : 'å‡ºå”®'}`;
            sliderContainer.appendChild(confirmButton);
            
            document.body.appendChild(sliderContainer);
        }
        
        sliderContainer.style.display = 'flex'; // æ˜¾ç¤ºè¿›åº¦æ¡
        const slider = document.getElementById(`${actionType}-slider`);
        const quantityLabel = document.getElementById(`${actionType}-quantity`);
        
        currentSlider = sliderContainer;
    
        let maxQuantity, price;
    
        if (isPurchase) {
            // è·å– UI ä¸Šçš„å›ºå®šä»·æ ¼
            const availableRoom = Math.max(0, scalpingState.maxWarehouseCapacity - scalpingState.usedWarehouseCapacity);
            price = parseInt(document.getElementById(`price-${item.name}`).innerText); 
            maxQuantity = Math.min(availableRoom, Math.floor(scalpingState.currentCash / price)); // æœ€å¤§å¯è´­ä¹°æ•°é‡
        } else {
            const itemInfo = scalpingState.holdItems[item.name];
            const itemName = scalpingItems.find(i => i.name === item.name);
            const marketItemPriceElement = document.getElementById(`price-${itemName.name}`);
            console.log({itemInfo, marketItemPriceElement, itemName});
            if (!marketItemPriceElement) {
                price = itemInfo.averagePrice;
                maxQuantity = itemInfo.quantity; // æœ€å¤§å¯å‡ºå”®æ•°é‡
            } else {
                price = parseInt(document.getElementById(`price-${item.name}`).innerText); // è·å–å¸‚åœºä»·æ ¼
                maxQuantity = itemInfo.quantity; // æœ€å¤§å¯å‡ºå”®æ•°é‡
            }
        }
    
        // ç›‘å¬è¿›åº¦æ¡å˜åŒ–
        slider.addEventListener('input', (event) => {
            const percentage = event.target.value;
            const quantity = Math.floor((percentage / 100) * maxQuantity);
            quantityLabel.innerText = `${isPurchase ? 'è´­ä¹°' : 'å‡ºå”®'}æ•°é‡: ${quantity}, é¢„è®¡é‡‘é¢: ${price * quantity}`;
        });
    
        // ç‚¹å‡»ç¡®è®¤è´­ä¹°/å‡ºå”®
        document.getElementById(`confirm-${actionType}-button`).addEventListener('click', () => {
            const quantity = Math.floor((slider.value / 100) * maxQuantity);
            if (quantity > 0) {
                if (isPurchase) {
                    // æ‰§è¡Œè´­ä¹°é€»è¾‘
                    const totalCost = quantity * price;
                    if (scalpingState.usedWarehouseCapacity + quantity <= scalpingState.maxWarehouseCapacity) {
                        scalpingState.currentCash -= totalCost;
                        scalpingState.usedWarehouseCapacity += quantity;
    
                        if (!scalpingState.holdItems[item.name]) {
                            scalpingState.holdItems[item.name] = { averagePrice: price, quantity };
                        } else {
                            const currentHold = scalpingState.holdItems[item.name];
                            const newTotalQuantity = currentHold.quantity + quantity;
                            const newAveragePrice = Math.floor(((currentHold.averagePrice * currentHold.quantity) + (price * quantity)) / newTotalQuantity);
                            scalpingState.holdItems[item.name] = { averagePrice: newAveragePrice, quantity: newTotalQuantity };
                        }
                        
                        updateWarehouseItems();
                    } else {
                        showMerchant('ä»“åº“å®¹é‡ä¸è¶³ï¼Œæ— æ³•è´­ä¹°');
                    }
                } else {
                    // æ‰§è¡Œå‡ºå”®é€»è¾‘
                    const totalSaleValue = quantity * price;
                    scalpingState.currentCash += totalSaleValue;
                    itemInfo.quantity -= quantity;
                    scalpingState.usedWarehouseCapacity -= quantity; // æ›´æ–°ä»“åº“å®¹é‡
                    
                    if (itemInfo.quantity === 0) {
                        delete scalpingState.holdItems[item.name]; // ç§»é™¤å–å®Œçš„ç‰©å“
                    }
    
                    updateWarehouseItems();
                }
                sliderContainer.style.display = 'none'; // å®Œæˆåéšè—è¿›åº¦æ¡
            } else if (currentSlider) {
                    document.body.removeChild(currentSlider);
                    currentSlider = null;
            }
        });
    }
    // è§¦å‘è´­ä¹°
    function handleItemPurchase(item, price) {
        const revokeSandIndex = scalpingState.gadgets.indexOf('å”¤ç¥ç ‚');
        
        // å…ˆæ£€æŸ¥ä»“åº“å®¹é‡
        if (scalpingState.usedWarehouseCapacity === scalpingState.maxWarehouseCapacity) {
            showMerchant('ä½ çš„ä»“åº“å·²æ»¡ï¼');
            return;
        }
    
        // å†æ£€æŸ¥ç©å®¶ç²¾åŠ›
        if (scalpingState.playerEnergy <= 60) {
            if (revokeSandIndex !== -1) {
                handleItemTransaction(item, null, 'purchase');
                // ä½¿ç”¨ splice æ¥åˆ é™¤ "å”¤ç¥ç ‚"
                scalpingState.gadgets.splice(revokeSandIndex, 1);
            } else {
                showMerchant('ä¸è¦è¿™ä¹ˆæ®šç²¾ç«­è™‘ï¼Œä½ éœ€è¦å¥½å¥½ä¼‘æ¯ä¸€ä¸‹ï¼');
            }
            return;
        }
        
        // è‹¥é€šè¿‡æ‰€æœ‰æ£€æŸ¥ï¼Œå¤„ç†è´­ä¹°
        handleItemTransaction(item, null, 'purchase');
    }
    
    // è§¦å‘å‡ºå”®
    function handleItemSell(item, itemInfo) {
        // æŸ¥æ‰¾æ˜¯å¦æœ‰ "å”¤ç¥ç ‚"
        const revokeSandIndex = scalpingState.gadgets.indexOf('å”¤ç¥ç ‚');
        
        // è·å–ç©å®¶æŒæœ‰çš„ç‰©å“å’Œå¸‚åœºä¸­è¯¥ç‰©å“çš„ç›¸å…³ä¿¡æ¯
        const holdItem = scalpingState.holdItems[item.name];
        const itemName = scalpingItems.find(i => i.name === item.name);
        const marketItemPriceElement = document.getElementById(`price-${itemName.name}`);
    
        // æ£€æŸ¥ç©å®¶ç²¾åŠ›
        if (scalpingState.playerEnergy <= 60) {
            if (revokeSandIndex !== -1) {
                // æ‹¥æœ‰ "å”¤ç¥ç ‚"ï¼Œå…è®¸ç»§ç»­å‡ºå”®å¹¶åˆ é™¤ "å”¤ç¥ç ‚"
                handleItemTransaction(item, itemInfo, 'sell');
                scalpingState.gadgets.splice(revokeSandIndex, 1);  // åˆ é™¤å”¤ç¥ç ‚
            } else {
                // æ²¡æœ‰ "å”¤ç¥ç ‚"ï¼Œæç¤ºç©å®¶ä¼‘æ¯
                showMerchant('ä¸è¦è¿™ä¹ˆæ®šç²¾ç«­è™‘ï¼Œä½ éœ€è¦å¥½å¥½ä¼‘æ¯ä¸€ä¸‹ï¼');
            }
            return;
        }
    
        const qianKunBagIndex = scalpingState.gadgets.indexOf('ä¹¾å¤è¢‹');
        // æ£€æŸ¥å¸‚åœºä¸­æ˜¯å¦æœ‰è¯¥å•†å“çš„é”€å”®æ¸ é“
        if (!marketItemPriceElement && qianKunBagIndex === -1) {
            showMerchant('å¸‚åœºç›®å‰æ²¡æœ‰è¯¥å•†å“çš„é”€å”®æ¸ é“ï¼Œæ— æ³•å‡ºå”®');
            return;
        } else if (!marketItemPriceElement && qianKunBagIndex !== -1) {
            handleItemTransaction(item, itemInfo, 'sell');
            scalpingState.gadgets.splice(qianKunBagIndex, 1);
        } else {
            handleItemTransaction(item, itemInfo, 'sell');
        }
    }
    
    document.getElementById('player-reputation').addEventListener('click', () => {
        showMerchant('\n1. å£°æœ›æ˜¯ä½ åœ¨èµ„æœ¬å¢é•¿è¿‡ç¨‹ä¸­ç§¯ç´¯çš„æ•°å€¼ã€‚ \n2. å£°æœ›è¶Šé«˜ï¼Œæ¯ä¸ªå­£åº¦ï¼ˆæ¯10å‘¨ï¼‰å›é¡¾æ—¶ä¼šå¾—åˆ°ç‰¹æ®Šå¥–åŠ±ã€‚ \n3. å£°æœ›è¿˜ä¼šå¯¹ç‰¹æ®Šäº‹ä»¶çš„èµ°å‘äº§ç”Ÿå½±å“ã€‚');
    });
            
    document.getElementById('player-energy').addEventListener('click', () => {
        const energy = scalpingState.playerEnergy;
        const cash = scalpingState.currentCash;
        const recoverCostRatio = 100 - energy;
        const recoverCost = Math.pow(recoverCostRatio, 4);
    
        if (cash >= recoverCost) {
            showInfoBox(`\n1. æ¯å‘¨åˆ·æ–°æ—¶ä¼šæ‰£é™¤ç²¾åŠ›ï¼Œç²¾åŠ›ä½äº60æ—¶å°†æ— æ³•è¿›è¡Œä»»ä½•äº¤æ˜“ã€‚\n\n2. ç²¾åŠ›ä¸è¶³æ—¶å¯ä»¥é€‰æ‹©ä¼‘æ¯ä¸¤å‘¨æˆ–åœ¨æ­¤å¯¹è¯æ¡†å†…ç‚¹å‡»ç¡®è®¤èŠ±è´¹ç°é‡‘è¡¥å……ã€‚ \n\n3. ä½ å¯ä»¥èŠ±è´¹${recoverCost}å…ƒç«‹å³æ¢å¤åˆ°æ»¡ç²¾åŠ›çŠ¶æ€ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ`,
                        () => {
                            scalpingState.currentCash -= recoverCost;
                            scalpingState.playerEnergy = 100;
                            updateScalpingPanel();
                            showMerchant('ä¸€æ ¹ä¸Šå¥½çš„å‚æ±¤è¿›è¡¥ï¼Œä½ åˆç„•å‘äº†é¾™é©¬ç²¾ç¥');
                        },null,'crimson','https://pic.imgdb.cn/item/66e32523d9c307b7e995cf28.png','88px * 88px')
        } else {
            showMerchant(`å½“å‰éœ€è¦${recoverCost}å…ƒæ¥æ¢å¤ç²¾åŠ›ï¼Œä½ çš„ç°é‡‘ä¸è¶³ï¼`);
        }
    });
            
    // æ›´æ–°ä»“åº“æŒæœ‰ç‰©å“
    function updateWarehouseItems() {
        const warehousePanel = document.getElementById('warehouse-item-info');
        warehousePanel.innerHTML = ''; // æ¸…ç©ºç°æœ‰ä»“åº“å†…å®¹
        
        Object.keys(scalpingState.holdItems).forEach(itemName => {
            const itemInfo = scalpingState.holdItems[itemName];
            const item = scalpingItems.find(i => i.name === itemName);
    
            // åˆ›å»ºä»“åº“ç‰©å“å…ƒç´ 
            const itemElement = document.createElement('div');
            itemElement.className = 'warehouse-item';
            itemElement.style = 'display: flex;justify-content: space-between;align-items: center;font-size: 14px;';
            itemElement.innerHTML = `
                <div id="${item.name}-warehouse-container" style="cursor: pointer;">
                    <img src="${item.url}" alt="${item.name}" style="width: 45px; height: 45px; border: 1px solid #6f391c" />
                    <div>${item.name}</div>
                </div>
                <div>${itemInfo.averagePrice} å…ƒ</div>
                <div>${itemInfo.quantity}ä¸ª</div>
            `;
            
            // ç‚¹å‡»ç‰©å“è¿›è¡Œå‡ºå”®
            itemElement.addEventListener('click', () => {
                handleItemSell(item, itemInfo);
            });
    
            warehousePanel.appendChild(itemElement);
        });
        updateScalpingPanel();
    }
    
    // ä»“åº“æ‰©å±•æŒ‰é’®é€»è¾‘
    document.getElementById('enlarge-warehouse-button').addEventListener('click', () => {
        const upgradeCost = 10000 * Math.max(1, (Math.pow(scalpingState.warehouseUpdateCount , 2)));
        const refreshCost = Math.max(0, Math.floor(scalpingState.maxWarehouseCapacity * 20));
        showInfoBox(`ä½ å¯ä»¥èŠ±è´¹${upgradeCost}å…ƒå¼€å¯100ä¸ªä»“åº“`,
                   () => {
                        if (scalpingState.currentCash >= upgradeCost) {
                            scalpingState.currentCash -= upgradeCost;
                            scalpingState.maxWarehouseCapacity += 100;
                            scalpingState.warehouseUpdateCount++;
                            updateScalpingPanel();
                            showMerchant(`ä½ çš„ä»“åº“æ‰©å……ä¸º${scalpingState.maxWarehouseCapacity}ä¸ªäº†ï¼ç°åœ¨æ¯å‘¨éœ€è¦æ”¯ä»˜${refreshCost}å…ƒåœºåœ°ç§Ÿé‡‘å“¦ï¼`);
                        } else {
                            showMerchant('ç°é‡‘ä¸è¶³ï¼');
                        }
                   },
                   null,
                   'red','https://pic.imgdb.cn/item/66e32523d9c307b7e995cf28.png','88px * 88px');
    });
            
    function calculateNetAsset() {
        let netAsset = 0;
        let itemsValue = 0;
    
        // è®¡ç®—æŒæœ‰çš„ç‰©å“çš„èµ„äº§
        Object.keys(scalpingState.holdItems).forEach(itemName => {
            const itemInfo = scalpingState.holdItems[itemName];
            const item = scalpingItems.find(i => i.name === itemName);
            
            if (!item) {
                return; // å¦‚æœæ‰¾ä¸åˆ°è¯¥ç‰©å“ï¼Œè·³è¿‡è¯¥å•†å“
            }
    
            // æŸ¥æ‰¾å¸‚åœºä¸Šæ˜¯å¦å­˜åœ¨è¯¥å•†å“çš„ä»·æ ¼å…ƒç´ 
            const marketItemPriceElement = document.getElementById(`price-${itemName}`);
            let marketPrice = null;
    
            if (marketItemPriceElement) {
                // ä»å¸‚åœºå…ƒç´ ä¸­è·å–ä»·æ ¼
                marketPrice = parseInt(marketItemPriceElement.innerText);
            }
    
            // è®¡ç®—å½“å‰å•†å“çš„èµ„äº§å€¼ï¼Œç¡®ä¿åªä½¿ç”¨å¸‚åœºä»·æ ¼æˆ–å¹³å‡ä»·æ ¼ä¹‹ä¸€
            let itemAssetValue = 0;
    
            if (marketPrice) {
                // ä½¿ç”¨å¸‚åœºä»·æ ¼
                itemAssetValue = itemInfo.quantity * marketPrice;
            } else if (itemInfo.averagePrice) {
                // å¦‚æœå¸‚åœºä»·æ ¼ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨å¹³å‡ä»·æ ¼
                itemAssetValue = itemInfo.quantity * itemInfo.averagePrice;
            } else {
                console.warn(`å•†å“ ${itemName} æ²¡æœ‰å¸‚åœºä»·æ ¼å’Œå¹³å‡ä»·æ ¼ï¼Œè·³è¿‡è®¡ç®—`);
                return; // æ²¡æœ‰ä»·æ ¼çš„æƒ…å†µä¸‹è·³è¿‡è¯¥å•†å“çš„è®¡ç®—
            }
    
            // ç´¯åŠ åˆ°æ€»èµ„äº§
            itemsValue += itemAssetValue;
        });
    
        // è®¡ç®—æŒæœ‰çš„è‚¡ç¥¨çš„èµ„äº§
        const stocksOwned = stockList.filter(s => s.quantity > 0);
        const kaimanzhizhao = scalpingState.gadgets.find(gadget => gadget === 'å¼€æ›¼å²›æ‰§ç…§');
        let stockValue = 0;
        let tax = 0.9;
        if (kaimanzhizhao) tax = 0.95;
    
        stocksOwned.forEach(stock => {
            // ç¡®ä¿ stock.basePrice æ˜¯æœ€æ–°çš„å¸‚åœºä»·æ ¼
            if (typeof stock.basePrice !== 'number') {
                console.warn(`è‚¡ç¥¨ ${stock.name} çš„åŸºç¡€ä»·æ ¼æ— æ•ˆï¼Œè·³è¿‡è®¡ç®—`);
                return;
            }
            // è®¡ç®—è‚¡ç¥¨ä»·å€¼å¹¶è€ƒè™‘ç¨ç‡
            stockValue += stock.quantity * stock.basePrice * tax;
        });
        
        // å°†ç°é‡‘åŠ å…¥åˆ°æ€»èµ„äº§
        netAsset = Math.floor(scalpingState.currentCash + itemsValue + stockValue);
    
        return netAsset;
    }
       
    function calculatePlayerReputation() {
        const netAsset = calculateNetAsset();
        let reputation = 0;
        reputation = Math.max(0, Math.floor(Math.max(0, (netAsset - 200000) / 500)) + scalpingState.playerReputation);
        
        return reputation;
    }
            
    //ç”¨äºæ›´æ–°ç»†èŠ‚ï¼Œé¿å…é‡å¤å‡½æ•°
    function updateScalpingPanel() {
        const currentSellingWeek = document.getElementById('current-selling-week');
        const maxSellingWeek = document.getElementById('max-selling-week');
        const playerEnergy = document.getElementById('player-energy');
        const playerReputation = document.getElementById('player-reputation');
        const currentCash = document.getElementById('current-cash');
        const netAsset = document.getElementById('net-asset');
        const usedWarehouseCapacity = document.getElementById('used-warehouse-capacity');
        const maxWarehouseCapacity = document.getElementById('max-warehouse-capacity');
        const relaxButton = document.getElementById('relax-byweek'); 
        const gadgetButton = document.getElementById('add-scalping-gadgets');
        const scalpingScoreElement = document.getElementById('scalping-score');
    
        currentSellingWeek.innerText = scalpingState.currentSellingWeek;  // ä¾‹å¦‚æ›´æ–°å½“å‰å‘¨
        maxSellingWeek.innerText = scalpingState.maxSellingWeek;     // æ›´æ–°æœ€å¤§å‘¨æ•°
        playerEnergy.innerText = scalpingState.playerEnergy;
        playerReputation.innerText = calculatePlayerReputation();  // æ›´æ–°å£°æœ›
        currentCash.innerText = scalpingState.currentCash;      // æ›´æ–°å½“å‰ç°é‡‘
        netAsset.innerText = calculateNetAsset();        // æ›´æ–°æ€»èµ„äº§
        usedWarehouseCapacity.innerText = scalpingState.usedWarehouseCapacity;  // æ›´æ–°å·²ä½¿ç”¨ä»“åº“å®¹é‡
        maxWarehouseCapacity.innerText = scalpingState.maxWarehouseCapacity;  // æ›´æ–°æœ€å¤§ä»“åº“å®¹é‡
        scalpingScoreElement.innerText = scalpingScore;
        checkGagdetsState(); //æ›´æ–°æ³•å®åº”ç”¨æƒ…å†µ
        recordAchivements(); //æ›´æ–°å®æ—¶è®°å½•
        checkStockPhaseAndDisplay();
        
        if (scalpingState.playerEnergy <= 60) {
            relaxButton.style.display = 'flex';
            document.getElementById('player-energy').innerText = `${scalpingState.playerEnergy} è¡¥ğŸ’‰`;
            document.getElementById('player-energy').style.color = 'red';
        } else {
            relaxButton.style.display = 'none';
            document.getElementById('player-energy').innerText = scalpingState.playerEnergy;
            document.getElementById('player-energy').style.color = 'white';
        }
    
        if (scalpingState.gadgets.length === 3) {
            gadgetButton.style.display = 'none';
        } else {
            gadgetButton.style.display = 'flex';
        } 
    }
    
    function checkStockPhaseAndDisplay() {
        const stockInfo = document.getElementById('stock-info-display');
        const hasStock = stockList.filter(s => s.quantity > 0);
        
        if (hasStock.length === 0 && keyPhaseCount === 0) {
            stockInfo.innerText = 'å½“å‰æ²¡æœ‰æŠ•èµ„ä»»ä½•è‚¡ç¥¨';
        } else if (hasStock.length === 0 && keyPhaseCount > 0) {
            stockInfo.innerText = `${calculateNetAsset() > 5000000 ? 'ã€ç‰›å¸‚å‘¨æœŸã€‘' : 'ã€ç†Šå¸‚å‘¨æœŸã€‘'}å½“å‰æ²¡æœ‰æŠ•èµ„ä»»ä½•è‚¡ç¥¨`;
        } 
        
        if (hasStock.length === 1) {
            if (keyPhaseCount === 0) {
                stockInfo.innerText = `å½“å‰æŒæœ‰${hasStock.find(h => h.quantity > 0).quantity}æ‰‹${hasStock.find(h => h.quantity > 0).name}çš„è‚¡ç¥¨`;
            } else {
                stockInfo.innerText = `${calculateNetAsset() > 5000000 ? 'ã€ç‰›ã€‘' : 'ã€ç†Šã€‘'}å½“å‰æŒæœ‰${hasStock.find(h => h.quantity > 0).quantity}æ‰‹${hasStock.find(h => h.quantity > 0).name}çš„è‚¡ç¥¨`;
            }
        } else if (hasStock.length > 1) { 
            if (keyPhaseCount === 0) {
                stockInfo.innerText = `å½“å‰æ€»è®¡æŒæœ‰${hasStock.length}æ”¯è‚¡ç¥¨`;
            } else {
                stockInfo.innerText = `${calculateNetAsset() > 5000000 ? 'ã€ç‰›ã€‘' : 'ã€ç†Šã€‘'}å½“å‰æ€»è®¡æŒæœ‰${hasStock.length}æ”¯è‚¡ç¥¨`;
            }
        }  
    }
            
    function checkGagdetsState() {
        const gadgetsElement = document.getElementById('applied-scalping-gadgets');
    
        // ç¡®ä¿ gadgetsElement å­˜åœ¨
        if (!gadgetsElement) {
            console.error('gadgetsElement not found');
            return;
        }
    
        // è·å– gadgetsElement ä¸­çš„æ‰€æœ‰å­å…ƒç´  (åŒ…å« img å…ƒç´ çš„ div)
        const appliedGadgetsDivs = Array.from(gadgetsElement.children);
    
        // æå–æ¯ä¸ªå­å…ƒç´ çš„ img.alt å±æ€§ï¼Œå¹¶æ ¹æ® alt æŸ¥æ‰¾ jinnangItems ä¸­å¯¹åº”çš„é“å…·
        const existingGadgets = appliedGadgetsDivs.map(div => {
            const img = div.querySelector('img'); // è·å– div ä¸­çš„ img å…ƒç´ 
            if (img && img.alt) {
                // æ ¹æ® img çš„ alt å±æ€§æŸ¥æ‰¾ jinnangItems ä¸­å¯¹åº”çš„é“å…·
                const jinnangItem = jinnangItems.find(item => item.name === img.alt);
                if (jinnangItem) {
                    return jinnangItem.displayName; // è¿”å›é“å…·çš„ä¸­æ–‡æ˜ å°„ displayName
                }
            }
            return null; // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ï¼Œè¿”å› null
        }).filter(Boolean); // è¿‡æ»¤æ‰ null å€¼
    
        // ä¿ç•™ stillExistingGadgets ä¸­å­˜åœ¨äº scalpingState.gadgets çš„é“å…·
        const stillExistingGadgets = scalpingState.gadgets.filter(gadget => {
            return existingGadgets.includes(gadget);
        });
    
        // éå† appliedGadgetsDivsï¼Œç§»é™¤é‚£äº›ä¸å†å­˜åœ¨äº stillExistingGadgets ä¸­çš„å…ƒç´ 
        appliedGadgetsDivs.forEach(div => {
            const img = div.querySelector('img'); // è·å– img å…ƒç´ 
            if (img && img.alt) {
                const jinnangItem = jinnangItems.find(item => item.name === img.alt);
                if (jinnangItem && !stillExistingGadgets.includes(jinnangItem.displayName)) {
                    // å¦‚æœé“å…·ä¸åœ¨ stillExistingGadgets ä¸­ï¼Œç§»é™¤è¯¥å…ƒç´ 
                    gadgetsElement.removeChild(div);
                }
            }
        });
    }
    
    let currentInfoBox = null;
    
    function showInfoBox(message, onConfirm, onCancel, textColor = '#92341C', imageUrl = null, size = '45px * 45px') {
        // å¦‚æœå·²ç»æœ‰ä¸€ä¸ªä¿¡æ¯æ¡†å­˜åœ¨ï¼Œå…ˆå…³é—­å®ƒ
        if (currentInfoBox) {
            document.body.removeChild(currentInfoBox);
            currentInfoBox = null;
        }
    
        // åˆ›å»ºæç¤ºæ¡†å…ƒç´ 
        const infoBox = document.createElement('div');
        infoBox.style.position = 'fixed';
        infoBox.style.top = '50%';
        infoBox.style.left = '50%';
        infoBox.style.transform = 'translate(-50%, -50%)';
        infoBox.style.width = '80%';
        infoBox.style.maxHeight = '80%';
        infoBox.style.minHeight = '10%';
        infoBox.style.zIndex = '9999';
        infoBox.style.fontSize = '14px';
        infoBox.style.padding = '10px 20px 5px 20px';
        infoBox.style.backgroundColor = '#DFBF6E';
        infoBox.style.color = textColor; // ä½¿ç”¨å¯é€‰å‚æ•°è®¾ç½®æ–‡æœ¬é¢œè‰²
        infoBox.style.backgroundImage = 'url(https://pic.imgdb.cn/item/663885620ea9cb14033e4f6e.png)';
        infoBox.style.backgroundRepeat = 'repeat';
        infoBox.style.backgroundSize = 'auto';
        infoBox.style.boxShadow = '0px 0px 0px 1px rgb(30, 46, 47), inset 0 0 0px 1px #6f391c';
        infoBox.style.border = '1px solid #EBAC3B';
        infoBox.style.overflowY = 'auto'; // å¤„ç†å†…å®¹è¿‡å¤šæ—¶çš„æ»šåŠ¨
    
        // å¦‚æœæœ‰ä¼ å…¥å›¾ç‰‡URLï¼Œæ·»åŠ å›¾ç‰‡å…ƒç´ 
        if (imageUrl) {
            const [width, height] = size.split('*').map(s => s.trim()); // åˆ†è§£sizeå‚æ•°
    
            const imageElement = document.createElement('img');
            imageElement.src = imageUrl;
            imageElement.style.display = 'block';
            imageElement.style.margin = '0 auto'; // å±…ä¸­æ˜¾ç¤º
            imageElement.style.width = width; // è®¾ç½®å›¾ç‰‡å®½åº¦
            imageElement.style.height = height; // è®¾ç½®å›¾ç‰‡é«˜åº¦
            imageElement.style.objectFit = 'contain'; // ä¿æŒå›¾ç‰‡æ¯”ä¾‹
            infoBox.appendChild(imageElement);
        }
    
        // åˆ›å»ºæ¶ˆæ¯æ–‡æœ¬å…ƒç´ 
        const messageElement = document.createElement('p');
        messageElement.style.margin = '0px';
        messageElement.style.marginTop = imageUrl ? '10px' : '15px'; // å¦‚æœæœ‰å›¾ç‰‡åˆ™å‡å°‘é—´è·
        messageElement.style.wordBreak = 'auto-phrase';
        messageElement.style.maxHeight = '460px';
        messageElement.style.overflowY = 'scroll';
        messageElement.innerText = message;
        infoBox.appendChild(messageElement);
    
        // åˆ›å»ºæŒ‰é’®å®¹å™¨å…ƒç´ 
        const buttonContainer = document.createElement('div');
        buttonContainer.style.marginTop = '20px';
        buttonContainer.style.textAlign = 'right';
        buttonContainer.style.display = 'flex';
        buttonContainer.style.flexDirection = 'row';
        buttonContainer.style.justifyContent = 'center';
        buttonContainer.style.gap = '20px';
        infoBox.appendChild(buttonContainer);
    
        // ç»Ÿä¸€æŒ‰é’®æ ·å¼
        const buttonStyle = `
            background: linear-gradient(to bottom, #E47F47, #CE6633, #963D1C);
            box-shadow: inset 0px 0px 2px 1px #87431F;
            font-size: 14px;
            border-radius: 5px;
            color: #F9DE9B;
            padding: 0px 14px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            border: 1px solid #6f391c;
        `;
    
        // åˆ›å»ºç¡®è®¤æŒ‰é’®
        const confirmButton = document.createElement('button');
        confirmButton.innerText = 'ç¡®è®¤';
        confirmButton.style.cssText = buttonStyle;
        confirmButton.addEventListener('click', () => {
            document.body.removeChild(infoBox);
            currentInfoBox = null;
            if (typeof onConfirm === 'function') {
                onConfirm();
            }
        });
        buttonContainer.appendChild(confirmButton);
    
        // åˆ›å»ºå–æ¶ˆæŒ‰é’®
        const cancelButton = document.createElement('button');
        cancelButton.innerText = 'å–æ¶ˆ';
        cancelButton.style.cssText = buttonStyle;
        cancelButton.addEventListener('click', () => {
            document.body.removeChild(infoBox);
            currentInfoBox = null;
            if (typeof onCancel === 'function') {
                onCancel();
            }
        });
        buttonContainer.appendChild(cancelButton);
    
        // å°†æç¤ºæ¡†æ·»åŠ åˆ°é¡µé¢ä¸­
        document.body.appendChild(infoBox);
    
        // å°†å½“å‰ä¿¡æ¯æ¡†è®¾ç½®ä¸ºæ–°åˆ›å»ºçš„ä¿¡æ¯æ¡†
        currentInfoBox = infoBox;
    }

    let goldAmount = 500000; // åˆå§‹é‡‘å­æ•°é‡
    function updateGoldDisplay(goldAmount) {
        const goldElement = document.getElementById('gold-amount');
        const wen = goldAmount % 1000;
        const liang = Math.floor(goldAmount / 1000) % 1000;
        const ding = Math.floor(goldAmount / 1000000);
    
        goldElement.innerText = `${ding}é”­${liang}ä¸¤${wen}æ–‡`;
        goldElement.style.color = 'white';
        goldElement.style.fontSize = '12px'; // å…¼å®¹æ€§å¤„ç†
    }

    // å•ä½æ¢ç®—å‡½æ•°
    function convertPrice(price) {
        let ding = Math.floor(price / 1000000);
        price %= 1000000;
        let liang = Math.floor(price / 1000);
        let wen = price % 1000;
    
        let result = '';
        if (ding > 0) {
            result += `${ding}é”­ `;
        }
        if (liang > 0) {
            result += `${liang}ä¸¤ `;
        }
        if (wen > 0 || result === '') {
            result += `${wen}æ–‡`;
        }
        return result.trim();
    }

    document.getElementById('gold-container').addEventListener('click', () => {
        showMerchant('\nä½œè€…å°†â€œè‡ªç”±ç»å•†â€åŠŸèƒ½åˆ†ç¦»ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å°æ¸¸æˆï¼Œä¹Ÿå°±æ˜¯ä½ ç°åœ¨çœ‹åˆ°çš„è¿™ä¸ªç•Œé¢ã€‚\n\nè¿™ä¸ªå°æ¸¸æˆåŸæœ¬å±äºâ€œå…»å® æ¨¡æ‹Ÿå™¨â€çš„ä¸€éƒ¨åˆ†ï¼Œå³ä½œä¸ºæ¸¸æˆä¸­é‡è¦è´§å¸â€œé‡‘å­â€çš„æ¥æºä¹‹ä¸€ã€‚ \n\nåœ¨åˆ†ç¦»åï¼Œé‡‘å­æ²¡æœ‰å®é™…ä½œç”¨ï¼Œä»…ä½œä¸ºæ¸¸æˆä¸­ç´¯åŠ çš„è®°å½•ã€‚');
    })



    function saveGameState() {
        showMerchant('è¿™å…¶å®æ˜¯ä¸ªå­˜æ¡£æŒ‰é’®ï¼Œä½ åœ¨ä¸‹æ¬¡åˆ·æ–°æ­¤é¡µé¢æ—¶ä¼šåŠ è½½ä½ çš„æ¸¸æˆæ•°æ®');
        const gameState = {
            scalpingScore : scalpingScore ,
            highestAsset : highestAsset ,
            goldAmount : goldAmount,
        }
        storeItems(); // å­˜å‚¨é“å…·æ•°æ®
        localStorage.setItem('gameState', JSON.stringify(gameState));
    }
        
    let gameItems = {
        jinnangItems: [] // ç”¨äºå­˜å‚¨ jinnangItems çš„ç‰©å“å’Œæ•°é‡
    };
        
    function storeItems() {
        gameItems.jinnangItems = jinnangItems.map(item => ({
            name: item.name,
            displayName: item.displayName,
            url: item.url,
            price: item.price,
            quantity: item.quantity,
            description: item.description,
        }));
    }
    
    // æ¢å¤é“å…·æ•°æ®
    function restoreItems() {
        for (const savedItem of gameItems.jinnangItems) {
            const item = jinnangItems.find(i => i.name === savedItem.name);
            if (item) {
                // å¦‚æœé“å…·å·²å­˜åœ¨ï¼Œæ›´æ–°æ•°é‡å’Œå…¶ä»–å±æ€§
                item.quantity = savedItem.quantity;
                item.displayName = savedItem.displayName;
                item.url = savedItem.url;
                item.price = savedItem.price;
                item.description = savedItem.description;
            }
        }
        updateGoldDisplay(goldAmount);
    }

    function loadGameState() {
        const savedState = JSON.parse(localStorage.getItem('gameState'));
        if (!savedState) return;
        if (savedState) {
            if (savedState.gameItems) {
                gameItems = savedState.gameItems;
                restoreItems(); // æ¢å¤é“å…·æ•°æ®
            }
            scalpingScore = savedState.scalpingScore;
            highestAsset = savedState.highestAsset;
            goldAmount = savedState.goldAmount;
        }
        updateGoldDisplay(goldAmount);
        updateScalpingPanel();
        
        console.log("è¯»æ¡£æˆåŠŸï¼");
    }
    window.onload = function() {
        if (localStorage.gameState) {
            loadGameState();
        }
        openScalping(closeButton = false);
    }

    </script>
</body>
</html>
